!function(t,e){"function"==typeof define&&define.amd?define(["d3","../common/SVGWidget","../api/I2DChart","../common/Text","../common/FAChar","../common/Utility","../api/ITooltip","css!./Pie"],e):t.chart_Pie=e(t.d3,t.common_SVGWidget,t.api_I2DChart,t.common_Text,t.common_FAChar,t.common_Utility,t.api_ITooltip)}(this,function(t,e,a,i,o,n,r){function s(i){e.call(this),a.call(this),r.call(this),this.labelWidgets={},this.d3Pie=t.layout.pie().padAngle(.0025).sort(function(t,e){return e>t?-1:t>e?1:0}).value(function(t){return t[1]}),this.d3Arc=t.svg.arc().padRadius(this.calcRadius()).innerRadius(this.innerRadius())}return s.prototype=Object.create(e.prototype),s.prototype.constructor=s,s.prototype._class+=" chart_Pie",s.prototype["implements"](a.prototype),s.prototype["implements"](r.prototype),s.prototype.publish("paletteID","default","set","Palette ID",s.prototype._palette["switch"](),{tags:["Basic","Shared"]}),s.prototype.publish("useClonedPalette",!1,"boolean","Enable or disable using a cloned palette",null,{tags:["Intermediate","Shared"]}),s.prototype.publish("outerText",!1,"boolean","Sets label position inside or outside chart",null,{tags:["Basic"]}),s.prototype.publish("innerRadius",0,"number","Sets inner pie hole radius as a percentage of the radius of the pie chart",null,{tags:["Basic"]}),s.prototype.calcRadius=function(t){return Math.min(this._size.width,this._size.height)/2-2},s.prototype.intersection=function(t,e){return this.intersectCircle(t,e)},s.prototype.enter=function(t,a){e.prototype.enter.apply(this,arguments),this._selection=new n.SimpleSelection(a)},s.prototype.update=function(a,n){function r(e,a){return function(){t.select(this).transition().delay(a).attrTween("d",function(a){var i=t.interpolate(a.outerRadius,s.calcRadius()+e);return function(t){return a.outerRadius=i(t),s.d3Arc(a)}})}}e.prototype.update.apply(this,arguments);var s=this;this._palette=this._palette["switch"](this.paletteID()),this.useClonedPalette()&&(this._palette=this._palette.cloneNotExists(this.paletteID()+"_"+this.id())),this.d3Arc.innerRadius(this.innerRadius_exists()?this.calcRadius()*this.innerRadius()/100:0);var l=n.selectAll(".arc").data(this.d3Pie(this.data()),function(t){return t.data[0]});if(l.enter().append("g").attr("class","arc").attr("opacity",0).call(this._selection.enter.bind(this._selection)).on("click",function(t){s.click(s.rowToObj(t.data),s.columns()[1],s._selection.selected(this))}).each(function(e){var a=t.select(this);a.append("path").on("mouseover.tooltip",function(t){s.tooltipShow(t.data,s.columns(),1)}).on("mouseout.tooltip",function(t){s.tooltipShow()}).on("mousemove.tooltip",function(t){s.tooltipShow(t.data,s.columns(),1)}).on("mouseover",r(0,0)).on("mouseout",r(-5,150)),e.data.__viz_faChar?s.labelWidgets[e.data[0]]=(new o)["char"](e.data.__viz_faChar).target(this).render():s.labelWidgets[e.data[0]]=(new i).text(e.data[0]).target(this).render()}),l.transition().attr("opacity",1).each(function(e){e.outerRadius=s.calcRadius()-5;var a={x:0,y:1};if(s.outerText()){var i=Math.cos((e.startAngle+e.endAngle-Math.PI)/2),o=Math.sin((e.startAngle+e.endAngle-Math.PI)/2),n=s.labelWidgets[e.data[0]].getBBox(),r=Math.abs(i)>Math.abs(o)?n.width:n.height;a.x=i*(s.calcRadius()+r),a.y=o*(s.calcRadius()+r)}else{var l=s.d3Arc.centroid(e);a={x:l[0],y:l[1]}}var c=t.select(this);c.select("path").transition().attr("d",s.d3Arc).style("fill",function(t){return s._palette(t.data[0])}),s.labelWidgets[e.data[0]].pos(a).render().element().classed("innerLabel",!s.outerText()).classed("outerLabel",s.outerText())}),l.exit().transition().style("opacity",0).remove(),s.outerText()){var c=n.selectAll("line").data(this.d3Pie(this.data()),function(t){return t.data[0]});c.enter().append("line").attr("x1",0).attr("x2",0).attr("y1",-this.calcRadius()-3).attr("y2",-this.calcRadius()-8).attr("stroke","gray").attr("transform",function(t){return"rotate("+(t.startAngle+t.endAngle)/2*(180/Math.PI)+")"}),c.transition().attr("transform",function(t){return"rotate("+(t.startAngle+t.endAngle)/2*(180/Math.PI)+")"}),c.exit().remove()}},s.prototype.exit=function(t,a){e.prototype.exit.apply(this,arguments),delete this._selectionBag},s});