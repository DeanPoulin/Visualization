!function(t,i){"function"==typeof define&&define.amd?define(["d3","../common/SVGWidget","./Axis","../common/Utility","css!./XYAxis"],i):t.chart_XYAxis=i(t.d3,t.common_SVGWidget,t.chart_Axis,t.common_Utility)}(this,function(t,i,e,s){function o(){i.call(this),this._drawStartPos="origin",this.domainAxis=(new e).orientation("bottom").type("ordinal").overlapMode("stagger").shrinkToFit("high").extend(0),this.valueAxis=(new e).orientation("left").type("linear").shrinkToFit("high")}return o.prototype=Object.create(i.prototype),o.prototype.constructor=o,o.prototype._class+=" chart_XYAxis",o.prototype.publish("orientation","horizontal","set","Selects orientation for the axis",["horizontal","vertical"]),o.prototype.publish("selectionMode",!1,"boolean","Range Selector"),o.prototype.publishProxy("xAxisTickCount","domainAxis","tickCount"),o.prototype.publishProxy("xAxisTickFormat","domainAxis","tickFormat"),o.prototype.publishProxy("xAxisType","domainAxis","type"),o.prototype.publishProxy("xAxisTypeTimePattern","domainAxis","timePattern"),o.prototype.publish("xAxisDomainLow",null,"string","X-Axis Low",null,{optional:!0,disable:function(t){return"ordinal"===t.xAxisType()}}),o.prototype.publish("xAxisDomainHigh",null,"string","X-Axis High",null,{optional:!0,disable:function(t){return"ordinal"===t.xAxisType()}}),o.prototype.publishProxy("xAxisOverlapMode","domainAxis","overlapMode"),o.prototype.publishProxy("xAxisLabelRotation","domainAxis","labelRotation"),o.prototype.publishProxy("xAxisDomainPadding","domainAxis","extend"),o.prototype.publishProxy("yAxisTitle","valueAxis","title"),o.prototype.publishProxy("yAxisTickCount","valueAxis","tickCount"),o.prototype.publishProxy("yAxisTickFormat","valueAxis","tickFormat"),o.prototype.publishProxy("yAxisType","valueAxis","type"),o.prototype.publishProxy("yAxisTypeTimePattern","valueAxis","timePattern"),o.prototype.publishProxy("yAxisTypePowExponent","valueAxis","powExponent"),o.prototype.publishProxy("yAxisTypeLogBase","valueAxis","logBase"),o.prototype.publish("yAxisDomainLow",null,"string","Y-Axis Low",null,{optional:!0,disable:function(t){return"ordinal"===t.yAxisType()}}),o.prototype.publish("yAxisDomainHigh",null,"string","Y-Axis High",null,{optional:!0,disable:function(t){return"ordinal"===t.yAxisType()}}),o.prototype.publishProxy("yAxisDomainPadding","valueAxis","extend"),o.prototype.publish("regions",[],"array","Regions"),o.prototype.publish("sampleData","","set","Display Sample Data",["","ordinal","ordinalRange","linear","time-x","time-y"]),o.prototype.resetSelection=function(){return this._prevBrush=null,this},o.prototype.columns=function(t){return i.prototype.columns.apply(this,arguments)},o.prototype.parseData=function(t){return this.domainAxis.parse(t)},o.prototype.parseValue=function(t){return this.valueAxis.parse(t,!0)},o.prototype.formatData=function(t){return this.domainAxis.format(t)},o.prototype.formatValue=function(t){return this.valueAxis.format(t,!0)},o.prototype.parsedData=function(){return this.data().map(function(t){return t.map(function(t,i){return 0===i?this.parseData(t):i>=this.columns().length?t:this.parseValue(t)},this)},this)},o.prototype.enter=function(e,o){i.prototype.enter.apply(this,arguments),this.svg=o.append("g"),this.svgRegions=o.append("g"),this.svgData=this.svg.append("g"),this.domainAxis.target(this.svg.node()),this.valueAxis.target(this.svg.node()),this.svgBrush=o.append("g").attr("class","brush");var n=this;this.xBrush=t.svg.brush().on("brush",function(){return n.brushMoved.apply(n,arguments)}),this.yBrush=t.svg.brush().on("brush",function(){return n.brushMoved.apply(n,arguments)}),this._selection=new s.SimpleSelection(this.svgData)},o.prototype.resizeBrushHandle=function(t,i,e){var s,o,n;return"e"===t||"w"===t?(s=+("e"===t),o=s?1:-1,n=e/3,"M"+.5*o+","+n+"A6,6 0 0 "+s+" "+6.5*o+","+(n+6)+"V"+(2*n-6)+"A6,6 0 0 "+s+" "+.5*o+","+2*n+"ZM"+2.5*o+","+(n+8)+"V"+(2*n-8)+"M"+4.5*o+","+(n+8)+"V"+(2*n-8)):(s=+("s"===t),n=s?1:-1,o=i/3,"M"+o+", "+.5*n+"A6,6 0 0 "+(s+1)%2+" "+(o+6)+","+6.5*n+"H"+(2*o-6)+"A6,6 0 0 "+(s+1)%2+" "+2*o+","+.5*n+"ZM"+(o+8)+","+2.5*n+"H"+(2*o-8)+"M"+(o+8)+","+4.5*n+"H"+(2*o-8))},o.prototype.brushMoved=i.prototype.debounce(function(){var t=this.data().filter(function(t){var i=t[0];return"ordinal"===this.xAxisType()&&(i=this.domainAxis.d3Scale(i)+(this.domainAxis.d3Scale.rangeBand?this.domainAxis.d3Scale.rangeBand()/2:0)),"horizontal"===this.orientation()?i>=this.xBrush.extent()[0]&&i<=this.xBrush.extent()[1]:i>=this.yBrush.extent()[0]&&i<=this.yBrush.extent()[1]},this);this.selection(t)},250),o.prototype.dataPos=function(t){return this.domainAxis.scalePos(t)},o.prototype.valuePos=function(t){return this.valueAxis.scalePos(t)},o.prototype.setScaleRange=function(t,i){this.xAxis.width(t),this.yAxis.height(i)},o.prototype.calcMargin=function(t,i,e){for(var s={top:!e&&this.selectionMode()?10:2,right:e&&this.selectionMode()?10:2,bottom:2,left:2},o=this.width()-s.left-s.right,n=this.height()-s.top-s.bottom,r=30,a=30,h=0;10>h;++h){this.xAxis.width(o-a).height(0);var p=this.xAxis.calcOverflow(i);this.yAxis.width(0).height(n-r);var l=this.yAxis.calcOverflow(i),u=p.depth,x=l.depth;if(u===r&&x===a){r=u,a=x;break}r=u,a=x}return this.xAxis.x(o/2+a/2+s.left).y(n+s.top).width(o-a),this.yAxis.x(s.left).y(n/2-r/2+s.top).height(n-r),s.left+=a,s.bottom+=r,s},o.prototype.updateRegions=function(i,e,s){var o=this,n=this.svgRegions.selectAll(".region").data(this.regions());n.enter().append("rect").attr("class","region"),s?n.attr("x",function(t){return o.dataPos(t.x0)}).attr("y",0).attr("width",function(t){return o.dataPos(t.x1)-o.dataPos(t.x0)}).attr("height",this.height()).style("stroke",function(t){return o._palette(t.colorID)}).style("fill",function(i){return t.hsl(o._palette(i.colorID)).brighter()}):n.attr("x",0).attr("y",function(t){return o.dataPos(t.x0)}).attr("width",this.width()).attr("height",function(t){return o.dataPos(t.x0)-o.dataPos(t.x1)}).style("stroke",function(t){return o._palette(t.colorID)}).style("fill",function(i){return t.hsl(o._palette(i.colorID)).brighter()}),n.exit().remove()},o.prototype.update=function(i,e){var s=this,o="horizontal"===this.orientation();this.updateRegions(i,e,o),this.domainAxis.orientation(o?"bottom":"left").title(this.columns()[0]),this.valueAxis.orientation(o?"left":"bottom"),this.xAxis=o?this.domainAxis:this.valueAxis,this.yAxis=o?this.valueAxis:this.domainAxis;var n=o?this.xBrush:this.yBrush,r=o?this.yBrush:this.xBrush,a=r.extent();switch(this.xAxisType()){case"ordinal":this.domainAxis.ordinals(this.data().map(function(t){return t[0]}));break;default:var h=this.xAxisDomainLow()?this.xAxisDomainLow():this.domainAxis.parseInvert(t.min(this.parsedData(),function(t){return t[0]})),p=this.xAxisDomainHigh()?this.xAxisDomainHigh():this.domainAxis.parseInvert(t.max(this.parsedData(),function(t){return t[0]}));void 0!==h&&void 0!==p&&this.domainAxis.low(h).high(p)}var l=this.yAxisDomainLow()?this.yAxisDomainLow():this.valueAxis.parseInvert(t.min(this.parsedData(),function(i){return t.min(i.filter(function(t,i){return i>0&&s.columns()[i]&&0!==s.columns()[i].indexOf("__")&&null!==t}),function(t){return t instanceof Array?t[0]:t})})),u=this.yAxisDomainHigh()?this.yAxisDomainHigh():this.valueAxis.parseInvert(t.max(this.parsedData(),function(i){return t.max(i.filter(function(t,i){return i>0&&s.columns()[i]&&0!==s.columns()[i].indexOf("__")&&null!==t}),function(t){return t instanceof Array?t[1]:t})}));this.valueAxis.low(l).high(u),this.margin=this.calcMargin(i,e,o),this.domainAxis.render(),this.valueAxis.render();var x=this.width()-this.margin.left-this.margin.right;0>x&&(x=0);var y=this.height()-this.margin.top-this.margin.bottom;0>y&&(y=0);var c=o?x:y,d=o?y:x;if(this.svgData.transition().attr("transform","translate("+this.margin.left+","+this.margin.top+")"),this.xBrush.x(this.domainAxis.d3Scale),this.yBrush.y(this.domainAxis.d3Scale),this.selectionMode()){if(this._prevXAxisType!==this.xAxisType()&&(this._prevXAxisType=this.xAxisType(),this._prevBrush=null),this._prevBrush){if(this._prevBrush&&this._prevBrush.orientation!==this.orientation())switch(this.xAxisType()){case"ordinal":n.extent([c-a[0]*c/this._prevBrush.maxCurrExtent,c-a[1]*c/this._prevBrush.maxCurrExtent]);break;default:n.extent(a)}}else switch(this.xAxisType()){case"ordinal":n.extent([0,c]);break;default:n.extent(this.domainAxis.d3Scale.domain())}this._prevBrush={orientation:this.orientation(),maxCurrExtent:c}}this.svgBrush.attr("transform","translate("+this.margin.left+", "+this.margin.top+")").style("display",this.selectionMode()?null:"none").call(n).selectAll(".background").transition().attr("width",x).attr("height",y),this.svgBrush.selectAll(".extent, .resize rect").transition().attr(o?"y":"x",0).attr(o?"height":"width",d);var A=this.svgBrush.selectAll(".resize").selectAll("path").data(function(t){return t});A.enter().append("path"),A.transition().attr("d",function(t){return s.resizeBrushHandle(t,x,y)}),this.updateChart(i,e,this.margin,x,y,o)},o.prototype.updateChart=function(t,i,e,s,o,n){},o.prototype.exit=function(t,e){i.prototype.exit.apply(this,arguments),delete this._selection},o.prototype.selection=function(t){console.log(t)},o});