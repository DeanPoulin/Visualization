(function(e,t){typeof define=="function"&&define.amd?define(["d3","../common/SVGWidget","./XYAxis","../api/INDChart","../api/ITooltip","css!./Scatter"],t):e.chart_Scatter=t(e.d3,e.common_SVGWidget,e.chart_XYAxis,e.api_INDChart,e.api_ITooltip)})(this,function(e,t,n,r,i){function s(e){n.call(this),r.call(this),i.call(this)}return s.prototype=Object.create(n.prototype),s.prototype.constructor=s,s.prototype._class+=" chart_Scatter",s.prototype.implements(r.prototype),s.prototype.implements(i.prototype),s.prototype.publish("paletteID","default","set","Palette ID",s.prototype._palette.switch(),{tags:["Basic","Shared"]}),s.prototype.publish("pointShape","cross","set","Shape of the data points",["circle","rectangle","cross"]),s.prototype.publish("pointSize",6,"number","Point Size"),s.prototype.publish("interpolate","","set","Interpolate Data",["","linear","step","step-before","step-after","basis","bundle","cardinal","monotone"]),s.prototype.publish("interpolateFill",!1,"boolean","Fill Interpolation"),s.prototype.publish("interpolateFillOpacity",.66,"number","Fill Interpolation Opacity"),s.prototype.publish("useClonedPalette",!1,"boolean","Enable or disable using a cloned palette",null,{tags:["Intermediate","Shared"]}),s.prototype.xPos=function(e){return this.orientation()==="horizontal"?this.dataPos(e.label):this.valuePos(e.value)},s.prototype.yPos=function(e){return this.orientation()==="horizontal"?this.valuePos(e.value):this.dataPos(e.label)},s.prototype.updateChart=function(t,n,r,i,s){function u(e){switch(e){case"rectangle":return"rect";case"circle":return"circle";case"cross":return"path"}}var o=this;this._palette=this._palette.switch(this.paletteID()),this.useClonedPalette()&&(this._palette=this._palette.cloneNotExists(this.paletteID()+"_"+this.id())),this._prevPointShape!==this.pointShape()&&(this.svgData.selectAll(".data").remove(),this._prevPointShape=this.pointShape());var a=this.flattenData().map(function(e){return e.shape=u(o.pointShape()),e}),f=this.svgData.selectAll(".point").data(a,function(e,t){return e.shape+"_"+t});f.enter().append("g").attr("class","point").each(function(t){var n=e.select(this);n.append("circle").attr("class","pointSelection").on("mouseover.tooltip",function(e){o.tooltipShow(o.data()[e.rowIdx],o._columns,e.colIdx)}).on("mouseout.tooltip",function(e){o.tooltipShow()}).on("mousemove.tooltip",function(e){o.tooltipShow(o.data()[e.rowIdx],o._columns,e.colIdx)}).call(o._selection.enter.bind(o._selection)).on("click",function(e,t){o.click(o.rowToObj(o.data()[e.rowIdx]),o._columns[e.colIdx],o._selection.selected(this))}),n.append(t.shape).attr("class","pointShape")}),f.each(function(t){var n=e.select(this).select(".pointSelection");n.attr("cx",function(e){return o.xPos(e)}).attr("cy",function(e){return o.yPos(e)}).attr("r",o.pointSize());var r=e.select(this).select(".pointShape");switch(t.shape){case"rect":r.attr("x",function(e){return o.xPos(e)-o.pointSize()/2}).attr("y",function(e){return o.yPos(e)-o.pointSize()/2}).attr("width",o.pointSize()).attr("height",o.pointSize()).style("fill",function(e,t){return o._palette(o._columns[e.colIdx])});break;case"circle":r.attr("cx",function(e){return o.xPos(e)}).attr("cy",function(e){return o.yPos(e)}).attr("r",o.pointSize()/2).style("fill",function(e,t){return o._palette(o._columns[e.colIdx])});break;case"path":r.attr("d",function(e){return"M"+(o.xPos(e)-o.pointSize()/2)+" "+(o.yPos(e)-o.pointSize()/2)+" "+"L"+(o.xPos(e)+o.pointSize()/2)+" "+(o.yPos(e)+o.pointSize()/2)+" "+"M"+(o.xPos(e)-o.pointSize()/2)+" "+(o.yPos(e)+o.pointSize()/2)+" "+"L"+(o.xPos(e)+o.pointSize()/2)+" "+(o.yPos(e)-o.pointSize()/2)}).style("stroke",function(e,t){return o._palette(o._columns[e.colIdx])})}}),f.exit().remove();var l=this.svgData.selectAll(".area").data(this.columns().filter(function(e,t){return o.interpolate()&&o.interpolateFill()&&t>0}));l.enter().append("path").attr("class","area");var c=e.svg.area().interpolate(this.interpolate());switch(this.orientation()){case"horizontal":c.x(function(e){return o.xPos(e)}).y0(function(e){return s}).y1(function(e){return o.yPos(e)});break;default:c.y(function(e){return o.yPos(e)}).x0(function(e){return 0}).x1(function(e){return o.xPos(e)})}l.each(function(t,n){var r=e.select(this);r.attr("d",c(a.filter(function(e){return e.colIdx===n+1}))).style("opacity",o.interpolateFillOpacity()).style("stroke","none").style("fill",function(t,r){return e.hsl(o._palette(o._columns[n+1])).brighter()})}),l.exit().remove();var h=this.svgData.selectAll(".line").data(this.columns().filter(function(e,t){return o.interpolate()&&t>0}));h.enter().append("path").attr("class","line");var p=e.svg.line().x(function(e){return o.xPos(e)}).y(function(e){return o.yPos(e)}).interpolate(this.interpolate());h.each(function(t,n){var r=e.select(this),i=a.filter(function(e){return e.colIdx===n+1});r.attr("d",p(i)).style("stroke",function(e,t){return o._palette(o._columns[n+1])}).style("fill","none")}),h.exit().remove()},s.prototype.exit=function(e,n){t.prototype.exit.apply(this,arguments)},s});