(function(e,t){typeof define=="function"&&define.amd?define(["d3","../common/HTMLWidget","amcharts.serial","require","../common/Utility"],t):e.amchart_CommonSerial=t(e.d3,e.common_HTMLWidget,e.AmCharts,e.require,e.common_Utility)})(this,function(e,t,n,r,i){function s(){t.call(this),this._tag="div",this._chart={},this._selected=null,this._selection=[],this._dateParserData=e.time.format("%Y-%m-%d").parse,this._dateParserValue=e.time.format("%Y-%m-%d").parse}s.prototype=Object.create(t.prototype),s.prototype.constructor=s,s.prototype._class+=" amchart_CommonSerial",s.prototype.publish("fontSize",11,"number","Font Size",null,{tags:["Basic","Shared"]}),s.prototype.publish("fontFamily","Verdana","string","Font Name",null,{tags:["Basic","Shared","Shared"]}),s.prototype.publish("fontColor","#000000","html-color","Font Color",null,{tags:["Basic","Shared"]}),s.prototype.publish("lineWidth",1,"number","Line Thickness",null,{min:0,max:10,step:1,inputType:"range",tags:["Basic","Shared"]}),s.prototype.publish("lineColor",null,"html-color","Color of the data/content lines",null,{tags:["Basic","Shared"]}),s.prototype.publish("lineOpacity",1,"number","Line Opacity",null,{min:0,max:1,step:.001,inputType:"range",tags:["Basic","Shared"]}),s.prototype.publish("dashedLineStyle",0,"number","Length of Dashed Line. 0 = none",null,{tags:["Advanced","Shared"]}),s.prototype.publish("axisFontSize",null,"number","X/Y Axis Text Font Size",null,{tags:["Basic","Shared"]}),s.prototype.publish("xAxisBaselineColor","#000000","html-color","X Axis Baseline Color",null,{tags:["Basic","Shared"]}),s.prototype.publish("yAxisBaselineColor","#000000","html-color","Y Axis baseline Color",null,{tags:["Basic","Shared"]}),s.prototype.publish("xAxisFontColor",null,"html-color","Horizontal Axis Text Style (Color)",null,{tags:["Basic","Shared"]}),s.prototype.publish("yAxisFontColor",null,"html-color","Vertical Axis Text Style (Color)",null,{tags:["Basic","Shared"]}),s.prototype.publish("xAxisTitle","","string","X-Axis Title",null,{tags:["Basic","Shared"]}),s.prototype.publish("yAxisTitle","","string","Y-Axis Title",null,{tags:["Basic","Shared"]}),s.prototype.publish("xAxisTitleFontSize",null,"number","Vertical Axis Title Text Style (Font Size)",null,{tags:["Basic","Shared"]}),s.prototype.publish("yAxisTitleFontSize",null,"number","Vertical Axis Title Text Style (Font Size)",null,{tags:["Intermediate","Shared"]}),s.prototype.publish("xAxisTitleFontColor",null,"html-color","Horizontal Axis Title Text Style (Color)",null,{tags:["Basic","Shared"]}),s.prototype.publish("yAxisTitleFontColor",null,"html-color","Vertical Axis Title Text Style (Color)",null,{tags:["Basic","Shared"]}),s.prototype.publish("xAxisLabelRotation",null,"number","X-Axis Label Rotation",null,{min:0,max:90,step:.1,inputType:"range",tags:["Intermediate","Shared"]}),s.prototype.publish("axisLineWidth",1,"number","Axis Line Width",null,{tags:["Intermediate","Shared"]}),s.prototype.publish("axisAlpha",1,"number","Axis Alpha",null,{tags:["Intermediate"]}),s.prototype.publish("marginLeft",null,"number","Margin (Left)",null,{tags:["Intermediate"]}),s.prototype.publish("marginRight",null,"number","Margin (Right)",null,{tags:["Intermediate"]}),s.prototype.publish("marginTop",null,"number","Margin (Top)",null,{tags:["Intermediate"]}),s.prototype.publish("marginBottom",null,"number","Margin (Bottom)",null,{tags:["Intermediate"]}),s.prototype.publish("showScrollbar",!1,"boolean","Show Chart Scrollbar",null,{tags:["Intermediate","Shared"]}),s.prototype.publish("orientation","horizontal","set","Orientation",["horizontal","vertical"],{tags:["Intermediate"]}),s.prototype.publish("xAxisAutoGridCount",!0,"boolean","Specifies Whether Number of GridCount Is Specified Automatically, According To The Axis Size",null,{tags:["Advanced"]}),s.prototype.publish("xAxisGridPosition","start","set","Specifies If A Grid Line Is Placed On The Center of A Cell or On The Beginning of A Cell",["start","middle"],{tags:["Advanced"]}),s.prototype.publish("xAxisBoldPeriodBeginning",!0,"boolean","When parse dates is on for the category axis, the chart will try to highlight the beginning of the periods, like month, in bold.",null,{tags:["Intermediate"]}),s.prototype.publish("yAxisBoldPeriodBeginning",!0,"boolean","When parse dates is on for the category axis, the chart will try to highlight the beginning of the periods, like month, in bold.",null,{tags:["Intermediate"]}),s.prototype.publish("xAxisDashLength",0,"number","Length of a dash. 0 means line is not dashed.",null,{tags:["Advanced"]}),s.prototype.publish("yAxisDashLength",0,"number","Length of a dash. 0 means line is not dashed.",null,{tags:["Advanced"]}),s.prototype.publish("xAxisFillAlpha",0,"number","Fill opacity. Every second space between grid lines can be filled with color. Set fillAlpha to a value greater than 0 to see the fills.",null,{tags:["Intermediate"]}),s.prototype.publish("yAxisFillAlpha",0,"number","Fill opacity. Every second space between grid lines can be filled with color. Set fillAlpha to a value greater than 0 to see the fills.",null,{tags:["Intermediate"]}),s.prototype.publish("xAxisFillColor",null,"html-color","Fill color. Every second space between grid lines can be filled with color. Set fillAlpha to a value greater than 0 to see the fills.",null,{tags:["Intermediate"]}),s.prototype.publish("yAxisFillColor",null,"html-color","Fill color. Every second space between grid lines can be filled with color. Set fillAlpha to a value greater than 0 to see the fills.",null,{tags:["Intermediate"]}),s.prototype.publish("xAxisGridAlpha",0,"number","Grid alpha.",null,{tags:["Intermediate"]}),s.prototype.publish("yAxisGridAlpha",0,"number","Grid alpha.",null,{tags:["Intermediate"]}),s.prototype.publish("yAxisTitleOffset",null,"number","",null,{tags:["Intermediate"]}),s.prototype.publish("startOnAxis",!0,"boolean","Draw Chart Starting On Axis.",null,{tags:["Intermediate"]}),s.prototype.publish("startDuration",.3,"number","Start Duration (sec)",null,{tags:["Private"]}),s.prototype.publish("useImgPatterns",!1,"boolean","Enable Image Pattern backgrounds",null,{tags:["Private"]}),s.prototype.publish("imgPatternArr",'["../ampatterns/black/pattern2.png"]',"string","Background Pattern Images (Not used if '[]')",null,{inputType:"textarea",tags:["Private"]}),s.prototype.publish("useClonedPalette",!1,"boolean","Enable or disable using a cloned palette",null,{tags:["Intermediate","Shared"]}),s.prototype.publish("xAxisTypeTimePattern","%Y-%m-%d","string","Time Series Pattern"),s.prototype.publish("yAxisTypeTimePattern","%Y-%m-%d","string","Time Series Pattern"),s.prototype.publish("yAxisType","linear","set","Y-Axis Type",["none","linear","pow","log","time"],{tags:["Intermediate","Shared"]}),s.prototype.publish("xAxisType","ordinal","set","X-Axis Type",["ordinal","linear","time"]),s.prototype.publish("yAxisTickFormat","s","string","Y-Axis Tick Format"),s.prototype.publish("sortDates",!1,"boolean","Sort date field for timeseries data"),s.prototype.publish("selectionColor","#f00","html-color","Font Color",null,{tags:["Basic"]}),s.prototype.publish("selectionMode","simple","set","Selection Mode",["simple","multi"],{tags:["Intermediate"]});var o=s.prototype.xAxisTypeTimePattern;s.prototype.xAxisTypeTimePattern=function(t){var n=o.apply(this,arguments);return arguments.length&&(this._dateParserData=e.time.format(t).parse),n};var u=s.prototype.yAxisTypeTimePattern;return s.prototype.yAxisTypeTimePattern=function(t){var n=u.apply(this,arguments);return arguments.length&&(this._dateParserValue=e.time.format(t).parse),n},s.prototype.formatData=function(e){switch(this.xAxisType()){case"time":return this._dateParserData(typeof e=="number"?e.toString():e);default:return e}},s.prototype.formatValue=function(e){if(!e)return e;if(e instanceof Array)return e.map(function(e){return this.formatValue(e)},this);switch(this.yAxisType()){case"time":return this._dateParserValue(typeof e=="number"?e.toString():e);default:if(typeof e=="string")return+e;return e}},s.prototype.amFormatData=function(e){this._rangeType=null;var t=[],n=this;return e.forEach(function(e){var r={};e.forEach(function(e,t){var i=n.columns()[t];if(e instanceof Array){var s=t-1;e.length===2?(r["openField"+s]=n.formatValue(e[0]),r["valueField"+s]=n.formatValue(e[1]),n._rangeType="normal"):(r["lowField"+s]=n.formatValue(e[0]),r["openField"+s]=n.formatValue(e[1]),r["closeField"+s]=n.formatValue(e[2]),r["highField"+s]=n.formatValue(e[3]),n._rangeType="candle-ohlc")}else t===0?r[i]=n.formatData(e):t>=n.columns().length?r[i]=e:r[i]=n.formatValue(e)}),t.push(r)}),t},s.prototype.updateChartOptions=function(){var t=this;this._chart.type="serial",this._chart.startDuration=this.startDuration(),this._chart.rotate=this.orientation()==="vertical",this._chart.color=this.fontColor(),this._chart.fontSize=this.fontSize(),this._chart.fontFamily=this.fontFamily(),this._chart.categoryAxis={},this._chart.categoryAxis.autoGridCount=this.xAxisAutoGridCount(),this._chart.categoryAxis.gridPosition=this.xAxisGridPosition(),this._chart.categoryAxis.axisAlpha=this.axisAlpha(),this._chart.categoryAxis.gridAlpha=this.xAxisGridAlpha(),this._chart.categoryAxis.startOnAxis=this.startOnAxis(),this._chart.categoryAxis.labelRotation=this.xAxisLabelRotation(),this._chart.categoryAxis.title=this.xAxisTitle(),this._chart.categoryAxis.axisColor=this.xAxisBaselineColor(),this._chart.categoryAxis.axisThickness=this.axisLineWidth(),this._chart.categoryAxis.boldPeriodBeginning=this.xAxisBoldPeriodBeginning(),this._chart.categoryAxis.dashLength=this.xAxisDashLength(),this._chart.categoryAxis.fillAlpha=this.xAxisFillAlpha(),this._chart.categoryAxis.fillColor=this.xAxisFillColor(),this._chart.categoryAxis.fontSize=this.axisFontSize(),this._chart.categoryAxis.color=this.xAxisFontColor(),this._chart.categoryAxis.titleColor=this.xAxisTitleFontColor(),this._chart.categoryAxis.titleFontSize=this.xAxisTitleFontSize(),this._chart.categoryAxis.labelFunction=function(e){return e};switch(this.xAxisType()){case"time":this._chart.categoryAxis.type="date",this._chart.categoryAxis.parseDates=!0,this._chart.categoryAxis.logarithmic=!1;break;case"log":this._chart.categoryAxis.parseDates=!1,this._chart.categoryAxis.logarithmic=!0,this._chart.categoryAxis.type="mumeric";break;case"linear":default:this._chart.categoryAxis.parseDates=!1,this._chart.categoryAxis.type="mumeric",this._chart.categoryAxis.logarithmic=!1}this.marginLeft()&&(this._chart.marginLeft=this.marginLeft()),this.marginRight()&&(this._chart.marginRight=this.marginRight()),this.marginTop()&&(this._chart.marginTop=this.marginTop()),this.marginBottom()&&(this._chart.marginBottom=this.marginBottom()),this._chart.valueAxes[0].title=this.yAxisTitle(),this._chart.valueAxes[0].titleColor=this.yAxisTitleFontColor(),this._chart.valueAxes[0].titleFontSize=this.yAxisTitleFontSize(),this._chart.valueAxes[0].axisThickness=this.axisLineWidth(),this._chart.valueAxes[0].color=this.yAxisFontColor(),this._chart.valueAxes[0].fontSize=this.axisFontSize(),this._chart.valueAxes[0].axisColor=this.yAxisBaselineColor(),this._chart.valueAxes[0].axisAlpha=this.axisAlpha(),this._chart.valueAxes[0].fillColor=this.yAxisFillColor(),this._chart.valueAxes[0].fillAlpha=this.yAxisFillAlpha(),this._chart.valueAxes[0].gridAlpha=this.yAxisGridAlpha(),this._chart.valueAxes[0].dashLength=this.yAxisDashLength(),this._chart.valueAxes[0].boldPeriodBeginning=this.yAxisBoldPeriodBeginning(),this._chart.valueAxes[0].axisTitleOffset=this.yAxisTitleOffset(),this._chart.valueAxes[0].labelFunction=function(n){return typeof n=="number"?e.format(t.yAxisTickFormat())(n):n};switch(this.yAxisType()){case"time":this._chart.valueAxes[0].type="date",this._chart.valueAxes[0].parseDates=!0,this._chart.valueAxes[0].logarithmic=!1,this.sortDates()&&this.data(i.naturalSort(this.data(),"ascending",0));break;case"log":this._chart.valueAxes[0].parseDates=!1,this._chart.valueAxes[0].logarithmic=!0,this._chart.valueAxes[0].type="mumeric";break;case"linear":default:this._chart.valueAxes[0].parseDates=!1,this._chart.valueAxes[0].type="mumeric",this._chart.valueAxes[0].logarithmic=!1}return this.showScrollbar()?this._chart.chartScrollbar.enabled=!0:this._chart.chartScrollbar.enabled=!1,this._chart.dataProvider=this.amFormatData(this.data()),this.amFormatColumns(),this._chart},s.prototype.buildGraphObj=function(e,t){var n=this,r={};r.balloonFunction=function(e){var t=e.category+", "+n.columns()[e.graph.columnIndex+1]+": "+n.data()[e.index][e.graph.columnIndex+1];return t},r.lineAlpha=n.lineOpacity(),r.lineColor=n.lineColor(),r.lineThickness=n.lineWidth(),r.dashLength=n.dashedLineStyle(),r.type=e,r.title="";var i=["value","open","close","high","low"];i.forEach(function(e){typeof n["_"+e+"Field"]!="undefined"&&typeof n["_"+e+"Field"][t]!="undefined"&&(r[e+"Field"]=n["_"+e+"Field"][t])});try{if(n.useImgPatterns()){var s=JSON.parse(n.imgPatternArr());typeof s[t]!="undefined"&&(r.pattern=s[t])}else r.pattern=""}catch(o){console.log("e:"),console.log(o)}return r},s.prototype.amFormatColumns=function(e){return this._categoryField=this.columns()[0],this._chart.categoryField=this.columns()[0],this._openField=[],this._closeField=[],this._valueField=this.columns().slice(1),this},s.prototype.enter=function(e,i){t.prototype.enter.apply(this,arguments);var s=this,o={type:"serial",addClassNames:!0,chartScrollbar:{}};typeof define=="function"&&define.amd&&(o.pathToImages=r.toUrl("amchartsImg")),this._chart=n.makeChart(e,o),this._chart.addListener("clickGraphItem",function(e){var t=e.graph,n=e.item.dataContext,r;s._gType==="column"?r=t.fillColorsField:s._gType==="line"?r=t.colorField:s._gType==="area"&&(r=t.colorField),r&&(n[r]!==null&&n[r]!==undefined?(delete n[r],s.selectionMode()==="simple"&&(s._selected!==null&&delete s._selected.data[s._selected.field],s._selected=null)):(n[r]=s.selectionColor(),s.selectionMode()==="simple"&&(s._selected!==null&&delete s._selected.data[s._selected.field],s._selected={field:r,data:n})),e.chart.validateData()),s.click(s.rowToObj(s.data()[e.index]),s.columns()[e.target.columnIndex+1])})},s.prototype.update=function(e,n){t.prototype.update.apply(this,arguments),e.style.width=this.size().width+"px",e.style.height=this.size().height+"px",this._palette=this._palette.switch(this.paletteID()),this.useClonedPalette()&&(this._palette=this._palette.cloneNotExists(this.paletteID()+"_"+this.id()))},s});