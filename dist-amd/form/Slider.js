!function(t,e){"function"==typeof define&&define.amd?define(["d3","../common/SVGWidget","../api/IInput","../common/Icon","css!./Slider"],e):t.form_Slider=e(t.d3,t.common_SVGWidget,t.api_IInput,t.common_Icon)}(this,function(t,e,i,s){function l(){e.call(this),i.call(this),this.selectionLabel(""),this._playing=!1,this._loop=!1,this.xScale=t.scale.linear().clamp(!0);var l=this;this._playIcon=(new s).faChar(""),this._playIcon.click=function(e){t.event.stopPropagation(),l._playing?l.pause():l.play()},this._loopIcon=(new s).faChar("").image_colorFill(this._loop?null:"#bbb").shape_colorFill(this._loop?null:"white").paddingPercent(33),this._loopIcon.click=function(t){l._loop?l._loop=!1:l._loop=!0,l._loopIcon.image_colorFill(l._loop?null:"#bbb").shape_colorFill(l._loop?null:"white").render()},this.brush=t.svg.brush().x(this.xScale).extent([0,0]).on("brushstart",function(t){l.brushstart(t,this)}).on("brush",function(t){l.brushmove(t,this)}).on("brushend",function(t){l.brushend(t,this)}),this.brush.empty=function(){return!1},this.axis=t.svg.axis().scale(this.xScale).orient("bottom").tickValues(null).tickFormat(function(t){return t}).tickSize(0).tickPadding(12),this._inputElement=[]}return l.prototype=Object.create(e.prototype),l.prototype.constructor=l,l.prototype._class+=" form_Slider",l.prototype["implements"](i.prototype),l.prototype.publish("padding",16,"number","Outer Padding",null,{tags:["Basic"]}),l.prototype.publish("fontSize",null,"number","Font Size",null,{tags:["Basic"]}),l.prototype.publish("fontFamily",null,"string","Font Name",null,{tags:["Basic"]}),l.prototype.publish("fontColor",null,"html-color","Font Color",null,{tags:["Basic"]}),l.prototype.publish("allowRange",!1,"boolean","Allow Range Selection",null,{tags:["Intermediate"]}),l.prototype.publish("low",0,"number","Low",null,{tags:["Intermediate"]}),l.prototype.publish("high",100,"number","High",null,{tags:["Intermediate"]}),l.prototype.publish("step",10,"number","Step",null,{tags:["Intermediate"]}),l.prototype.publish("selectionLabel","","string","Selection Label",null,{tags:["Intermediate"]}),l.prototype.publish("showPlay",!1,"boolean","Show Play Button"),l.prototype.publish("playInterval",1e3,"number","Play Interval"),l.prototype.publishProxy("playDiameter","_playIcon","diameter",32),l.prototype.publish("playGutter",12,"number","Play Gutter"),l.prototype.publishProxy("loopDiameter","_loopIcon","diameter",24),l.prototype.publish("loopGutter",4,"number","Play Gutter"),l.prototype.name=function(t){return l.prototype.columns.apply(this,arguments)},l.prototype.value=function(t){return l.prototype.data.apply(this,arguments)},l.prototype.play=function(){this._playing=!0,this._playIcon.faChar("").render();var t=this.data();(t<this.low()||t>=this.high())&&(t=this.low(),this.data(t).render(),this._click());var e=this;this.intervalHandler=setInterval(function(){t+=e.step(),t>e.high()?e._loop===!0?(t=e.low(),e.data(t).render(),e._click()):e.pause():(e.data(t).render(),e._click())},e.playInterval())},l.prototype.pause=function(){this._playing=!1,this._playIcon.faChar("").render(),clearInterval(this.intervalHandler)},l.prototype.data=function(t){var i=e.prototype.data.apply(this,arguments);return arguments.length&&this.brushg&&this.brushg.call(this.brush.extent(this.allowRange()?this.data():[this.data(),this.data()])),i},l.prototype.enter=function(t,e){this.sliderElement=e.append("g"),this._inputElement.push(this.sliderElement),this.axisElement=this.sliderElement.append("g").attr("class","x axis"),this.brushg=this.sliderElement.append("g").attr("class","brush").call(this.brush),this.brushg.select(".background").attr("y",-9).attr("height",18),this.brushg.select(".extent").attr("y","-10").attr("height","20"),this.brushg.selectAll(".resize").select("rect").attr("x",function(t){return"e"===t?0:-8}).attr("y","-10").attr("width","8").attr("height","20"),this.handle=this.brushg.selectAll(".resize").append("path").attr("class","handle").attr("transform","translate(0,-27)"),this._playIcon.target(this.sliderElement.node()).render(),this._loopIcon.target(this.sliderElement.node()).render()},l.prototype.calcDelta=function(t,e,i,s){var l=e.append("g").attr("class","x axis").attr("transform","translate(0, -64)").call(this.axis);l.selectAll(".tick > text").style("fill",this.fontColor()).style("font-size",this.fontSize()).style("font-family",this.fontFamily());var o=l.node().getBBox(),a={left:o.x-i,right:o.x-i+o.width-s};return l.remove(),a},l.prototype.update=function(e,i){var s=this,l=-this.width()/2+this.padding(),o=this.width()-2*this.padding();this._playIcon.pos({x:o/2-(this.loopDiameter()+this.loopGutter()+this.playDiameter()/2),y:0}).diameter(this.playDiameter()).display(this.showPlay()).render(),this._loopIcon.pos({x:o/2-this.loopDiameter()/2,y:0}).diameter(this.loopDiameter()).display(this.showPlay()).render(),(this.high()-this.low())/this.step()<=10?this.axis.tickValues(t.merge([t.range(this.low(),this.high(),this.step()),[this.high()]])):this.axis.tickValues(null),o-=this.showPlay()?this.loopDiameter()+this.loopGutter()+this.playDiameter()+this.playGutter():0,this.xScale.domain([this.low(),this.high()]).range([l,l+o]);var a=this.calcDelta(e,i,l,o);this.xScale.range([l-a.left,l+o-a.right]),this.axisElement.call(this.axis),this.axisElement.selectAll(".tick > text").style("fill",this.fontColor()).style("font-size",this.fontSize()).style("font-family",this.fontFamily());var n=this.xScale.range();this.brushg.select(".background").attr("x",n[0]).attr("width",n[1]-n[0]),this.handle.attr("d",function(t){return s.handlePath(t)}),0===this.data().length&&(this.allowRange()?this.data([this.low(),this.low()]):this.data(this.low())),this.brushg.call(this.brush.extent(this.allowRange()?this.data():[this.data(),this.data()]));var r=this.sliderElement.node().getBBox();this.sliderElement.attr("transform","translate(0, "+-(r.y+r.height/2)+")")},l.prototype.brushstart=function(e,i){t.event&&t.event.sourceEvent&&t.event.sourceEvent.stopPropagation()},l.prototype.brushmove=function(e,i){if(t.event&&t.event.sourceEvent&&(t.event.sourceEvent.stopPropagation(),!this.allowRange())){var s=this.xScale.invert(t.mouse(i)[0]);t.select(i).call(this.brush.extent([s,s]))}},l.prototype.brushend=function(e,i){if(t.event&&t.event.sourceEvent)if(t.event.sourceEvent.stopPropagation(),this.allowRange()){var s=this.brush.extent();s[0]=this.nearestStep(s[0]),s[1]=this.nearestStep(s[1]),this.data(s),t.select(i).call(this.brush.extent(s)),this.newSelection(s[0],s[1])}else{var l=this.nearestStep(this.xScale.invert(t.mouse(i)[0]));t.select(i).call(this.brush.extent([l,l])),this.data(l),this._click()}},l.prototype.nearestStep=function(t){return this.low()+Math.round((t-this.low())/this.step())*this.step()},l.prototype.handlePath=function(t,e){var i=+("e"===t),s=i?1:-1,l=this.allowRange()?.5:0,o=18,a="M"+l*s+","+o+"A6,6 0 0 "+i+" "+6.5*s+","+(o+6)+"V"+(2*o-6)+"A6,6 0 0 "+i+" "+l*s+","+2*o;return a+=this.allowRange()?"ZM"+2.5*s+","+(o+8)+"V"+(2*o-8)+"M"+4.5*s+","+(o+8)+"V"+(2*o-8):"M"+1*s+","+(o+8)+"V"+(2*o-8)},l.prototype._click=function(){if(this.selectionLabel()){var t={};t[this.selectionLabel()]=this.data(),this.click(t)}else this.click(this.data())},l.prototype.newSelection=function(t,e){console.log("newSelection:  "+t+", "+e)},l});