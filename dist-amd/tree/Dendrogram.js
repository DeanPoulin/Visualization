!function(t,e){"function"==typeof define&&define.amd?define(["d3","../common/SVGWidget","../api/ITree","css!./Dendrogram"],e):t.tree_Dendrogram=e(t.d3,t.common_SVGWidget,t.api_ITree)}(this,function(t,e,i){function a(t){e.call(this),i.call(this),this._drawStartPos="origin",this._maxTextWidth=0}return a.prototype=Object.create(e.prototype),a.prototype.constructor=a,a.prototype._class+=" tree_Dendrogram",a.prototype["implements"](i.prototype),a.prototype.publish("paletteID","default","set","Palette ID",a.prototype._palette["switch"](),{tags:["Basic","Shared"]}),a.prototype.publish("textOffset",8,"number","Text offset from circle",null,{tags:["Private"]}),a.prototype.publish("orientation","horizontal","set","Orientation",["horizontal","vertical"],{tags:["Private"]}),a.prototype.publish("useClonedPalette",!1,"boolean","Enable or disable using a cloned palette",null,{tags:["Intermediate","Shared"]}),a.prototype.enter=function(i,a){e.prototype.enter.apply(this,arguments);var o=this;this.layout=t.layout.cluster(),this.diagonal=t.svg.diagonal().projection(function(t){return"horizontal"===o.orientation()?[t.y,t.x]:[t.x,t.y]})},a.prototype.update=function(i,a,o){var n=this;e.prototype.update.apply(this,arguments),this._palette=this._palette["switch"](this.paletteID()),this.useClonedPalette()&&(this._palette=this._palette.cloneNotExists(this.paletteID()+"_"+this.id())),this.x(this._maxTextWidth);var r=this.width()-2*this._maxTextWidth;"horizontal"===this.orientation()?this.layout.size([this.height(),r]):this.layout.size([r,this.height()]);var s=this.layout.nodes(this.data()),l=this.layout.links(s),h=a.selectAll(".link").data(l);h.enter().append("path").attr("class","link"),h.attr("d",this.diagonal),h.exit().remove();var p=a.selectAll(".node").data(s);p.enter().append("g").attr("class","node").on("click",function(t){n.click(t)}).each(function(e){var i=t.select(this);i.append("circle"),i.append("text")});var c=0;p.attr("transform",function(t){return"horizontal"===n.orientation()?"translate("+t.y+","+t.x+")":"translate("+t.x+","+t.y+")"}),p.select("circle").attr("r",4.5).style("fill",function(t){return n._palette(t.label)}).append("title").text(function(t){return t.label}),p.select("text").style("text-anchor",function(t){return t.children?"end":"start"}).attr("dx",function(t){return t.children?-n.textOffset():n.textOffset()}).attr("dy",3).text(function(t){return t.label}).each(function(e){if(!o){var i=t.select(this).node().getBBox();i.width>c&&(c=i.width)}}),c+=this.textOffset(),p.exit().remove(),o||this._maxTextWidth===c||(this._maxTextWidth=c,this.update(i,a,!0))},a});