(function(e,t){typeof define=="function"&&define.amd?define(["require"],t):e.other_Persist=t(e.require)})(this,function(e){function t(e){var t=[],n=e._id===undefined;for(var r in e)if(r.indexOf("__meta_")>=0){var i=e,s=i[r];if(s.type)if(!n||s.type!=="proxy"){while(s.type==="proxy")i=i[s.proxy],s=i["__meta_"+s.method];s.id!==e[r].id&&(s=JSON.parse(JSON.stringify(s)),s.id=e[r].id),t.push(s)}}return t}function n(e,r){if(!e)return;r(e);var i=t(e);for(var s=0;s<i.length;++s){var o=i[s];switch(o.type){case"widget":n(e[o.id](),r);break;case"widgetArray":var u=e[o.id]();u.forEach(function(e){n(e,r)})}}}function r(e,r,i){n(e,function(e){var n=t(e);for(var r=0;r<n.length;++r){var s=n[r];i(e,s)}})}return{discover:t,widgetWalker:n,widgetPropertyWalker:r,serializeTheme:function(e,t){return JSON.stringify(this.serializeThemeToObject(e,t))},serializeThemeToObject:function(e,t){function i(e,t){var n=!1;for(var r in t)if(e.indexOf(t[r])!==-1){n=!0;break}return n}t=t||["surface","Color","Font","palette"];var n={};return r(e,null,function(e,r){if(e[r.id+"_modified"]()||typeof e["__meta_"+r.id].trueDefaultValue!="undefined")if(i(r.id,t)){var s=e._class.trim().split(" ");for(var o in s){n[s[o]]===undefined&&(n[s[o]]={});if(n[s[o]][r.id]===undefined){n[s[o]][r.id]=e[r.id]();break}if(n[s[o]][r.id]===e[r.id]())break}}}),n},removeTheme:function(e,t){r(e,null,function(e,t){var n=Object.getPrototypeOf(e);if(typeof e["__meta_"+t.id].trueDefaultValue!="undefined"){var r=n["__meta_"+t.id].trueDefaultValue;n["__meta_"+t.id].defaultValue=r,e[t.id+"_reset"](),delete n["__meta_"+t.id].trueDefaultValue}}),typeof t=="function"&&t.call(this)},applyTheme:function(e,t,n){var i=this;r(e,null,function(e,n){switch(n.type){case"widget":return i.applyTheme(e[n.id](),t),!0;case"widgetArray":var r=e[n.id]();return r.forEach(function(e){i.applyTheme(e,t)},this),!0;default:var s=e._class.trim().split(" ").reverse();for(var o in s)if(typeof t[s[o]]!="undefined"&&typeof t[s[o]][n.id]!="undefined"){var u=Object.getPrototypeOf(e);typeof u["__meta_"+n.id].trueDefaultValue=="undefined"&&(u["__meta_"+n.id].trueDefaultValue=e[n.id]()),u["__meta_"+n.id].defaultValue=t[s[o]][n.id]}}}),typeof n=="function"&&n.call(this)},serializeToObject:function(e,t,n){var i={__version:3,__class:e.classID(),__properties:{}};e._id.indexOf("_w")!==0&&(i.__id=e._id);var s=this;r(e,t,function(e,t){if(e[t.id+"_modified"]()||typeof e["__meta_"+t.id].trueDefaultValue!="undefined")switch(t.type){case"widget":return i.__properties[t.id]=s.serializeToObject(e[t.id](),null,n),!0;case"widgetArray":i.__properties[t.id]=[];var r=e[t.id]();return r.forEach(function(e,r){i.__properties[t.id].push(s.serializeToObject(e,null,n))}),!0;default:i.__properties[t.id]=e[t.id]()}});if(e.classID()==="marshaller_Graph"){var o=e.data().vertices;o&&(this.__vertices=o.map(function(e){return this.serializeToObject(e,null,n)},this))}return n&&(i.__data={},i.__data.columns=e.columns(),i.__data.data=e.data()),i},serialize:function(e,t,n){return JSON.stringify(this.serializeToObject(e,t,n))},deserializeFromObject:function(e,t,n){var i=0,s=this;r(e,null,function(e,n){e[n.id+"_reset"]();if(t.__properties[n.id]!==undefined)switch(n.type){case"widget":++i;var r=n.id;s.create(t.__properties[n.id],function(t){e[r](t),--i});break;case"widgetArray":++i;var o=n.id,u=t.__properties[n.id],a=[];a.length=u.length;var f=0;u.forEach(function(t,n){++f,s.create(t,function(e){a[n]=e,--f});var r=setInterval(function(){f<=0&&(clearInterval(r),f=undefined,e[o](a),--i)},20)});break;default:e[n.id](t.__properties[n.id])}});var o=setInterval(function(){if(i<=0){clearInterval(o),i=undefined;if(t.__data)for(var r in t.__data)e[r](t.__data[r]);n(e)}},20)},deserialize:function(e,t,n){typeof t=="string"&&(t=JSON.parse(t)),t.__id&&t.__id.indexOf("_w")!==0&&e._id!==t.__id&&console.log("Deserialize:  IDs do not match - "+e._id),this.deserializeFromObject(e,t,n)},create:function(t,n){typeof t=="string"&&(t=JSON.parse(t));var r="src/"+t.__class.split("_").join("/"),i=this;e([r],function(e){var r=new e;t.__id&&t.__id.indexOf("_w")!==0&&(r._id=t.__id),i.deserializeFromObject(r,t,n)})},clone:function(e,t){this.create(this.serializeToObject(e,[],!0),t)}}});