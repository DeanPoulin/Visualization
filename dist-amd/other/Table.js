(function(e,t){typeof define=="function"&&define.amd?define(["d3","../common/HTMLWidget","./Paginator","../common/Utility","css!./Table"],t):e.other_Table=t(e.d3,e.common_HTMLWidget,e.other_Paginator,e.common_Utility)})(this,function(e,t,n,r){function i(){t.call(this),this._tag="div",this._currentSort="",this._currentSortOrder=1,this.columns([]),this._paginator=new n,this._selectionBag=new r.Selection,this._selectionPrevClick=null,this._paginatorTableSpacing=4}return i.prototype=Object.create(t.prototype),i.prototype.constructor=i,i.prototype._class+=" other_Table",i.prototype.publish("renderHtmlDataCells",!1,"boolean","enable or disable HTML within cells",null,{tags:["Private"]}),i.prototype.publish("pagination",!1,"boolean","Enable or disable pagination",null,{tags:["Private"]}),i.prototype.publishProxy("itemsPerPage","_paginator"),i.prototype.publishProxy("pageNumber","_paginator","pageNumber",1),i.prototype.publishProxy("adjacentPages","_paginator"),i.prototype.publish("showHeader",!0,"boolean","Show or hide the table header",null,{tags:["Private"]}),i.prototype.publish("fixedHeader",!1,"boolean","Enable or disable fixed table header",null,{tags:["Private"]}),i.prototype.publish("fixedColumn",!1,"boolean","Enable or disable fixed first column",null,{tags:["Private"]}),i.prototype.publish("fixedSize",!1,"boolean","Fix Size to Min Width/Height"),i.prototype.publish("theadFontSize",null,"string","Table head font size",null,{tags:["Basic"],optional:!0}),i.prototype.publish("tbodyFontSize",null,"string","Table body font size",null,{tags:["Basic"],optional:!0}),i.prototype.publish("theadFontColor",null,"html-color","Table head font color",null,{tags:["Basic"],optional:!0}),i.prototype.publish("tbodyFontColor",null,"html-color","Table body font color",null,{tags:["Basic"],optional:!0}),i.prototype.publish("theadFontFamily",null,"string","Table head font family",null,{tags:["Basic"],optional:!0}),i.prototype.publish("tbodyFontFamily",null,"string","Table body font family",null,{tags:["Basic"],optional:!0}),i.prototype.publish("theadCellBorderColor",null,"html-color","Table head cell border color",null,{tags:["Basic"],optional:!0}),i.prototype.publish("theadRowBackgroundColor",null,"html-color","Table head row color",null,{tags:["Basic"],optional:!0}),i.prototype.publish("tbodyCellBorderColor",null,"html-color","Table body cell border color",null,{tags:["Basic"],optional:!0}),i.prototype.publish("tbodyRowBackgroundColor",null,"html-color","Table body row color",null,{tags:["Basic"],optional:!0}),i.prototype.publish("tbodyFirstColFontColor",null,"html-color","Table body first column font color",null,{tags:["Basic"],optional:!0}),i.prototype.publish("tbodyFirstColBackgroundColor",null,"html-color","Table body first column background color",null,{tags:["Basic"],optional:!0}),i.prototype.publish("tbodyHoverRowFontColor",null,"html-color","Table body hover row font color",null,{tags:["Basic"],optional:!0}),i.prototype.publish("tbodyHoverRowBackgroundColor",null,"html-color","Table body hover row background color",null,{tags:["Basic"],optional:!0}),i.prototype.publish("tbodySelectedRowFontColor",null,"html-color","Table body selected row color",null,{tags:["Basic"],optional:!0}),i.prototype.publish("tbodySelectedRowBackgroundColor",null,"html-color","Table body selected row color",null,{tags:["Basic"],optional:!0}),i.prototype.publish("tableZebraColor",null,"html-color","Table zebra row color",null,{tags:["Basic"],optional:!0}),i.prototype.data=function(e){var n=t.prototype.data.apply(this,arguments);return arguments.length&&(this._currentSort="",this._currentSortOrder=1),n},i.prototype.size=function(e){var n=t.prototype.size.apply(this,arguments);return arguments.length&&this.tableDiv&&(this.tableDiv.style("width",this._size.width+"px").style("height",this._size.height+"px"),this.headerDiv.style("width",this._size.width+"px").style("height",this._size.height+"px")),n},i.prototype.enter=function(e,n){t.prototype.enter.apply(this,arguments),this._parentElement.style("overflow","hidden"),this.tableDiv=n.append("div").attr("class","tableDiv"),this.table=this.tableDiv.append("table"),this.thead=this.table.append("thead").append("tr"),this.tbody=this.table.append("tbody"),this.headerDiv=n,this.tableDiv.style("overflow","auto").style("width",this.width()+"px").style("height",this.height()+"px"),this.headerDiv.style("width",this.width()+"px").style("height",this.height()+"px")},i.prototype._generateTempRow=function(){var e=this.tbody.append("tr");return e.append("td").text("QQQ"),e},i.prototype._createSelectionObject=function(e){var t=this;return{_id:e,element:function(){return t.tbody.selectAll("tr").filter(function(t){return t===e})}}},i.prototype._calcRowsPerPage=function(e){this._paginator.numItems()===0&&(this._paginator.numItems(1),this.itemsPerPage(1)),this._paginator.render();var t=this.thead.selectAll("th").node().clientHeight,n=this._generateTempRow(),r=n.node().clientHeight;n.remove();var i=this.calcHeight(this._paginator.element()),s=Math.floor((this.height()-t-i-(this.hasHScroll(this.tableDiv)?this.getScrollbarWidth():0)-this._paginatorTableSpacing*2)/r)||1;return s},i.prototype.update=function(n,r){t.prototype.update.apply(this,arguments);var i=this,s=e.select(".tableDiv > table").node().getBoundingClientRect();this.fixedSize()&&s.width!==0&&s.height!==0?r.attr({width:s.width+"px",height:s.height+"px"}):r.attr({width:"100%",height:"100%"}),this.showHeader()||this.fixedHeader(!1);var o=this.thead.selectAll("th").data(this.showHeader()?this.columns():[],function(e){return e});o.enter().append("th").each(function(t){var n=e.select(this);n.append("span").attr("class","thText"),n.append("span").attr("class","thIcon")}).on("click",function(e,t){i.headerClick(e,t)}),o.style("background-color",this.theadRowBackgroundColor()).style("border-color",this.theadCellBorderColor()).style("color",this.theadFontColor()).style("font-size",this.theadFontSize()),o.select(".thText").style("font-family",this.theadFontFamily()).text(function(e){return e}),o.select(".thIcon").text(function(e,t){return i._currentSortOrder===-1?i._currentSort===t?"":"":i._currentSort===t?"":""}),o.exit().remove(),o.order();if(this.pagination()){this._paginator.target()===null&&this._paginator.target(r.node());var u=this._calcRowsPerPage(o);this.itemsPerPage(u),this._paginator.numItems(this.data().length),this._tNumPages=Math.ceil(this._paginator.numItems()/this.itemsPerPage())||1,(this.pageNumber()>this._tNumPages||this.pageNumber()<=0)&&this.pageNumber(1),this._paginator._onSelect=function(e,t){i.pageNumber(e),i.render();return},this.tableDiv.style("overflow-y","hidden")}else this.tableDiv.style("overflow-y",null),this._paginator.numItems(0);var a=this.pageNumber()-1,f=this.itemsPerPage(),l=a*f,c=parseInt(a*f)+parseInt(f),h=null;this.pagination()?h=this.data().slice(l,c):h=this.data();var p=this.tbody.selectAll("tr").data(h);p.enter().append("tr").on("click.selectionBag",function(e,t){i.selectionBagClick(e),i.render();var n=i.headerDiv.selectAll(".rows-wrapper tbody tr").filter(function(e,n){return n===t}),r=i.table.selectAll("tbody tr").filter(function(e,n){return n===t});r.classed("hover",!0),i.applyRowStyles(r),i.applyFirstColRowStyles(n)}).on("click",function(t){i.click(i.rowToObj(t),null,i._selectionBag.isSelected(i._createSelectionObject(t))),i.applyRowStyles(e.select(this))}).on("mouseover",function(e,t){var n=i.headerDiv.selectAll(".rows-wrapper tbody tr").filter(function(e,n){return n===t});if(n.empty())return;n.classed("hover",!0);var r=i.table.selectAll("tbody tr").filter(function(e,n){return n===t});r.classed("hover",!0),r.classed("selected")&&n.classed("selected",!0),i.applyStyleToRows(r),i.applyFirstColRowStyles(n)}).on("mouseout",function(e,t){var n=i.headerDiv.selectAll(".rows-wrapper tbody tr").filter(function(e,n){return n===t});n.classed("hover",!1);var r=i.table.selectAll("tbody tr").filter(function(e,n){return n===t}).classed("hover",!1);i.applyStyleToRows(r),i.applyFirstColRowStyles(n)}),p.attr("class",function(e){if(i._selectionBag.isSelected(i._createSelectionObject(e)))return"selected"}),p.exit().remove(),p.each(function(){var t=e.select(this);i.applyStyleToRows(t)});var d=p.selectAll("td").data(function(e,t){return e});d.enter().append("td"),d[this.renderHtmlDataCells()?"html":"text"](function(e){return typeof e=="string"?e.trim():typeof e=="number"?e:""}),d.exit().remove(),this._paginator.render(),this.data().length&&this.fixedLabelsUpdate(n,r),i.applyStyleToRows(this.tbody.selectAll("tr")),this._paginator.right((this.hasVScroll(this.tableDiv)?this.getScrollbarWidth():0)+this._paginatorTableSpacing).bottom((this.hasHScroll(this.tableDiv)?this.getScrollbarWidth():0)+this._paginatorTableSpacing).render()},i.prototype.fixedLabelsUpdate=function(t,n){function m(){var p=n.selectAll("th");p.style("border-color",r.theadCellBorderColor());if(r.fixedHeader()){u.html(l.html()),o.style("width",r.table.style("width"));var d=r._parentElement.selectAll(".cols-wrapper th");p.each(function(t,n){var r=d.filter(function(e,t){return t===n}),i=e.select(this).style("width");r.style("width",i)}),d.on("click",function(e,t){r.headerClick(e,t)}),f.html("")}var v,m;if(r.fixedColumn()){f.html("");var g=parseInt(r.table.select("td").style("border-width")),y=r.table.selectAll("tbody > tr > td:first-child");v=r.fixedColumn()?y.node().offsetWidth:0;var b=parseInt(v)+parseInt(2*g),w=f.selectAll("thead").data([0]);if(r.showHeader()){var E=w.enter().insert("thead","tbody").append("tr").style("background-color",r.theadRowBackgroundColor());w.exit().remove();var S=E.selectAll("th").data(p.filter(function(e,t){return t===0}));S.attr("class","update"),S.enter().append("th").html(function(e,t){return e[t].innerHTML}),S.style("width",b+"px").style("color",r.theadFontColor()).style("font-size",r.theadFontSize()).style("font-family",r.theadFontFamily()).style("border-color",r.theadCellBorderColor()),S.exit().remove()}var x=f.selectAll("tbody").data([0]);x.enter().append("tbody"),x.exit().remove();var T=x.selectAll("tr").data(y[0]);T.enter().append("tr").each(function(){var t=e.select(this);t.append("td").html(function(e){return e.innerHTML||"&nbsp;"})}),T.style("color",r.tbodyFontColor()).style("font-size",r.tbodyFontSize()).style("font-family",r.tbodyFontFamily()).style("border-color",r.tbodyCellBorderColor()),f.style("width",v),r.fixedHeader()?(w.style("position","absolute").style("width",b+"px"),f.style("margin-top",-t.scrollTop+c+"px"),n.style("top",c+"px")):r.showHeader()?(w.style("margin-top","0px").style("position","relative"),f.style("margin-top",-t.scrollTop+"px"),n.style("top","0px")):w.remove();var N=f.selectAll("tr");N.on("click",function(t,n){e.select(i[0][n]).on("click.selectionBag")(i.data()[n-1],n-1)}).on("mouseover",function(t,n){e.select(i[0][n]).on("mouseover")(i.data()[n-1],n-1)}).on("mouseout",function(t,n){e.select(i[0][n]).on("mouseout")(i.data()[n-1],n-1)}).attr("class",function(t,n){var s=r.showHeader()?1:0;if(i[0][n-s]&&e.select(i[0][n-s]).classed("selected")===!0)return i[0][n-s].parentElement.querySelector(":hover")===i[0][n-s]?"selected hover":"selected"})}else v=0;r.showHeader()||(h=0),m=parseInt(r.headerDiv.node().style.height)-parseInt(h);var C=parseInt(r.headerDiv.node().style.width)-parseInt(v),k=r.table.node().offsetWidth-v+r.getScrollbarWidth(),L=C>k?k:C;r.tableDiv.style("width",L+"px").style("height",m+"px").style("position","absolute").style("top",h+"px").style("left",v+"px").style("overflow","auto"),r.table.style("margin-left","-"+v+"px").style("margin-top","-"+c+"px"),s.style("position","absolute"),a.style("width",v+"px").style("position","absolute"),f.style("margin-top",-r.tableDiv.node().scrollTop+h+"px"),f.select("thead").style("margin-top",r.tableDiv.node().scrollTop-h+"px").on("click",function(e,t){r.headerClick(e,t)})}function g(e){e.onscroll=function(e){var t=e.target.scrollLeft,n=e.target.scrollTop;o.style("margin-left",-t+"px"),f.style("margin-top",-n+h+"px"),f.select("thead").style("margin-top",n-h+"px")}}var r=this,i=this.tbody.selectAll("tr");i.selectAll("td").style("color",this.tbodyFontColor()).style("font-size",this.tbodyFontSize()).style("font-family",this.tbodyFontFamily()).style("border-color",this.tbodyCellBorderColor());var s=this.headerDiv.selectAll(".cols-wrapper").data(this.fixedHeader()?[0]:[]);s.enter().insert("div",".rows-wrapper").attr("class","cols-wrapper").each(function(t){var n=e.select(this);n.append("table").classed("labels-wrapper",!0).append("thead")}),s.exit().remove();var o=s.select(".labels-wrapper"),u=s.select(".labels-wrapper > thead"),a=this.headerDiv.selectAll(".rows-wrapper").data(this.fixedColumn()?[0]:[]);a.enter().append("div").attr("class","rows-wrapper").each(function(t){var n=e.select(this);n.append("table").classed("labels-wrapper",!0)}),a.exit().remove();var f=a.select(".labels-wrapper"),l=this.table.select("thead"),c=this.fixedHeader()||!this.showHeader()?l.node().offsetHeight:0,h=c;m(this._id),g(this.tableDiv.node());var p=s.selectAll(".labels-wrapper tr"),d=a.selectAll(".labels-wrapper tbody > tr"),v=a.selectAll(".labels-wrapper thead > tr");p.style("background-color",this.theadRowBackgroundColor()),v.style("background-color",this.theadRowBackgroundColor()),r.applyFirstColRowStyles(d),setTimeout(function(){r.applyStyleToRows(r.tbody.selectAll("tr"))},0)},i.prototype.exit=function(e,n){this._paginator.target(null),t.prototype.exit.apply(this,arguments)},i.prototype.sort=function(e){this._currentSort!==e?(this._currentSort=e,this._currentSortOrder=1):this._currentSortOrder*=-1;var t=this;return this.data().sort(function(n,r){return n[e]===r[e]?0:typeof r[e]=="undefined"||n[e]>r[e]?t._currentSortOrder:t._currentSortOrder*-1}),this},i.prototype.headerClick=function(e,t){this.sort(t).render()},i.prototype.selection=function(e){return arguments.length?(this._selectionBag.set(e.map(function(e){return this._createSelectionObject(e)},this)),this):this._selectionBag.get().map(function(e){return e._id})},i.prototype.selectionBagClick=function(t){if(e.event.shiftKey){var n=!1,r=[],i=this.data().filter(function(e,i){var s=!1;if(e===t||e===this._selectionPrevClick)n&&(s=!0),n=!n,r.push(i);return n||s},this);return this.selection(i),r}this._selectionBag.click(this._createSelectionObject(t),e.event),this._selectionPrevClick=t},i.prototype.applyHoverRowStyles=function(e){var t=this;e.style("color",t.tbodyHoverRowFontColor()).style("background-color",t.tbodyHoverRowBackgroundColor())},i.prototype.applySelectedRowStyles=function(e){var t=this;e.style("color",t.tbodySelectedRowFontColor()).style("background-color",t.tbodySelectedRowBackgroundColor())},i.prototype.applyRowStyles=function(e,t){e.style("color",t?this.tbodyFirstColFontColor():this.tbodyFontColor()).style("background-color",t?this.tbodyFirstColBackgroundColor():this.tableZebraColor_exists()&&this.data().indexOf(e.datum())%2?this.tbodyRowBackgroundColor():this.tableZebraColor())},i.prototype.applyFirstColRowStyles=function(e){this.applyStyleToRows(e,!0)},i.prototype.applyStyleToRows=function(t,n){n=typeof n!="undefined"?n:!1;var r=this;t.each(function(){var t=e.select(this);t.classed("hover")?r.applyHoverRowStyles(t):t.classed("selected")?r.applySelectedRowStyles(t):r.applyRowStyles(t,n)})},i.prototype.click=function(e,t){console.log("Click:  "+JSON.stringify(e)+", "+t)},i});