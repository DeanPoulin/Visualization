(function(e,t){typeof define=="function"&&define.amd?define(["d3"],t):e.common_PropertyExt=t(e.d3)})(this,function(e){function r(e,t,n,r,i,s){this.id=e,this.type=n,this.origDefaultValue=t,this.defaultValue=t,this.description=r,this.set=i,this.ext=s||{};switch(n){case"set":this.checkedAssign=function(t){return(!i||i.indexOf(t)<0)&&console.log("Invalid value for '"+e+"':  "+t+" expected "+n),t};break;case"html-color":this.checkedAssign=function(t){if(window.__hpcc_debug&&t&&t!=="red"){var r="red",i=document.createElement("div");i.style.color=r,i.style.color=t,(i.style.color===r||i.style.color==="")&&console.log("Invalid value for '"+e+"':  "+t+" expected "+n)}return t};break;case"boolean":this.checkedAssign=function(e){return typeof e=="string"&&["false","off","0"].indexOf(e.toLowerCase())>=0?!1:Boolean(e)};break;case"number":this.checkedAssign=function(e){return Number(e)};break;case"string":this.checkedAssign=function(e){return String(e)};break;case"array":this.checkedAssign=function(t){return t instanceof Array||console.log("Invalid value for '"+e+"':  "+t+" expected "+n),t};break;case"object":this.checkedAssign=function(t){return t instanceof Object||console.log("Invalid value for '"+e+"':  "+t+" expected "+n),t};break;case"widget":this.checkedAssign=function(t){return(!t._class||t._class.indexOf("common_Widget")<0)&&console.log("Invalid value for '"+e+"':  "+t+" expected "+n),t};break;case"widgetArray":this.checkedAssign=function(t){return t.some(function(e){return!e._class||e._class.indexOf("common_Widget")<0})&&console.log("Invalid value for '"+e+"':  "+t+" expected "+n),t};break;default:this.checkedAssign=function(t){return window.__hpcc_debug&&console.log("Unchecked property type for '"+e+"':  "+t+" expected "+n),t}}}function i(e,t,n,r){this.id=e,this.type="proxy",this.proxy=t,this.method=n,this.defaultValue=r}function s(){this.publishedProperties().forEach(function(e){switch(e.type){case"array":case"widgetArray":this[n+e.id]=[]}},this)}var t="__meta_",n="__prop_";return s.prototype.publishedProperties=function(){var e=[];for(var n in this)n.indexOf(t)===0&&e.push(this[n]);return e},s.prototype.publishedProperty=function(e){return this[t+e]},s.prototype.publish=function(e,i,s,o,u,a){if(this[t+e]!==undefined&&!a.override)throw e+" is already published.";var f=this[t+e]=new r(e,i,s,o,u,a);this[e]=function(t){var r=this._id===undefined;return arguments.length?(t===""&&f.ext.optional?t=null:t!==null&&(t=f.checkedAssign(t)),r?f.defaultValue=t:(this.broadcast(e,t,this[n+e]),t===null?delete this[n+e]:this[n+e]=t),this):!r&&this[n+e]!==undefined?this[n+e]:f.defaultValue},this[e+"_modified"]=function(){var t=this._id===undefined;return t?f.defaultValue!==i:this[n+e]!==undefined},this[e+"_exists"]=function(){var t=this._id===undefined;return t?f.defaultValue!==undefined:this[n+e]!==undefined||f.defaultValue!==undefined},this[e+"_reset"]=function(){switch(s){case"widget":this[n+e]&&this[n+e].target(null);break;case"widgetArray":this[n+e]&&this[n+e].forEach(function(e){e.target(null)})}delete this[n+e]}},s.prototype.publishWidget=function(e,t,r){for(var i in t.prototype)if(i.indexOf("__meta")===0){var s=t.prototype[i];this.publishProxy(e+n+s.id,r,s.method||s.id)}},s.prototype.publishProxy=function(e,n,r,s){r=r||e;if(this[t+e]!==undefined)throw e+" is already published.";this[t+e]=new i(e,n,r,s),this[e]=function(t){var i=this._id===undefined;if(i)throw"Setting default value of proxied properties is not supported.";return arguments.length?(s&&t===s?this[n][r+"_reset"]():this[n][r](t),this):!s||this[e+"_modified"]()?this[n][r]():s},this[e+"_modified"]=function(){var e=this._id===undefined;if(e)throw"Setting default values of proxied properties is not supported.";return this[n][r+"_modified"]()&&(!s||this[n][r]()!==s)},this[e+"_reset"]=function(){var e=this._id===undefined;if(e)throw"Setting default values of proxied properties is not supported.";this[n][r+"_reset"]()}},s.prototype.watch=function(e){var t=this,n=this._watchArr.push(e)-1;return{remove:function(){delete t._watchArr[n]}}},s.prototype.broadcast=function(e,t,n){this._watchArr&&t!==n&&this._watchArr.forEach(function(r){r&&setTimeout(function(){r(e,t,n)},0)})},s});