typeof define=="function"&&define.amd&&define("css",[],function(){return{load:function(e,t,n){n()}}}),function(e,t){typeof define=="function"&&define.amd?define("layout/AbsoluteSurface",["d3","../common/HTMLWidget","../common/TextBox","css!./AbsoluteSurface"],t):e.layout_AbsoluteSurface=t(e.d3,e.common_HTMLWidget,e.common_TextBox)}(this,function(e,t,n){function r(){t.call(this),this._tag="div"}return r.prototype=Object.create(t.prototype),r.prototype.constructor=r,r.prototype._class+=" layout_AbsoluteSurface",r.prototype.publish("units","percent","set","Units",["pixels","percent"]),r.prototype.publish("widgetX",0,"number","Widget XPos"),r.prototype.publish("widgetY",0,"number","Widget YPos"),r.prototype.publish("widgetWidth","100","string","Widget Width, omit for full"),r.prototype.publish("widgetHeight","100","string","Widget Height, omit for full"),r.prototype.publish("widget",null,"widget","Widget",null,{tags:["Private"]}),r.prototype.publish("opacity",1,"number","Opacity"),r.prototype.testData=function(){return this.widgetX(25).widgetY(25).widgetWidth(50).widgetHeight(50).widget((new n).testData()),this},r.prototype.enter=function(e,n){t.prototype.enter.apply(this,arguments)},r.prototype.update=function(e,n){t.prototype.update.apply(this,arguments);var r=0,i=0,s=this.clientWidth(),o=this.clientHeight();switch(this.units()){case"pixels":r=this.widgetX(),i=this.widgetY(),s=this.widgetWidth()===""?s-r:Number(this.widgetWidth()),o=this.widgetHeight()===""?o-i:Number(this.widgetHeight());break;case"percent":r=this.widgetX()*s/100,i=this.widgetY()*o/100,s=this.widgetWidth()===""?s-r:Number(this.widgetWidth()*s/100),o=this.widgetHeight()===""?o-i:Number(this.widgetHeight()*o/100)}n.style("opacity",this.opacity());var u=n.selectAll("#"+this._id+" > .placeholder").data(this.widget()?[this.widget()]:[],function(e){return e._id});u.enter().append("div").attr("class","placeholder").each(function(e){e.target(this)}),u.style({left:r+"px",top:i+"px",width:s+"px",bottom:o+"px"}).each(function(e){e.resize({width:s,height:o})}),u.exit().each(function(e){e.target(null)}).remove()},r.prototype.exit=function(e,n){this.widget()&&(this.widget(null),this.render()),t.prototype.exit.apply(this,arguments)},r}),function(e,t){typeof define=="function"&&define.amd?define("layout/Surface.js",["d3","../common/HTMLWidget","../common/TextBox","css!./Surface","css!font-awesome"],t):e.layout_Surface=t(e.d3,e.common_HTMLWidget,e.common_TextBox)}(this,function(e,t,n){function r(){t.call(this),this._tag="div",this._surfaceButtons=[]}return r.prototype=Object.create(t.prototype),r.prototype.constructor=r,r.prototype._class+=" layout_Surface",r.prototype.publish("title","","string","Title",null,{tags:["Intermediate"]}),r.prototype.publish("widget",null,"widget","Widget",null,{tags:["Basic"]}),r.prototype.publish("surfaceTitlePadding",null,"number","Title Padding (px)",null,{tags:["Advanced"]}),r.prototype.publish("surfaceTitleFontSize",null,"number","Title Font Size (px)",null,{tags:["Advanced"]}),r.prototype.publish("surfaceTitleFontColor",null,"html-color","Title Font Color",null,{tags:["Advanced"]}),r.prototype.publish("surfaceTitleFontFamily",null,"string","Title Font Family",null,{tags:["Advanced"]}),r.prototype.publish("surfaceTitleFontBold",!0,"boolean","Enable Bold Title Font",null,{tags:["Advanced"]}),r.prototype.publish("surfaceTitleBackgroundColor",null,"html-color","Title Background Color",null,{tags:["Advanced"]}),r.prototype.publish("surfacePadding",null,"string","Surface Padding (px)",null,{tags:["Intermediate"]}),r.prototype.publish("surfaceBackgroundColor",null,"html-color","Surface Background Color",null,{tags:["Advanced"]}),r.prototype.publish("surfaceBorderWidth",null,"number","Surface Border Width (px)",null,{tags:["Advanced"]}),r.prototype.publish("surfaceBorderColor",null,"html-color","Surface Border Color",null,{tags:["Advanced"]}),r.prototype.publish("surfaceBorderRadius",null,"number","Surface Border Radius (px)",null,{tags:["Advanced"]}),r.prototype.publish("surfaceTitleAlignment","center","set","Title Alignment",["left","right","center"],{tags:["Basic"]}),r.prototype.publish("buttonAnnotations",[],"array","Button Array",null,{tags:["Private"]}),r.prototype.testData=function(){return this.title("ABC"),this.widget((new r).widget((new n).testData())),this.buttonAnnotations([{id:"button_1",label:"",width:60,padding:"5px","class":"",font:"FontAwesome",callback:function(e){console.log("Click Override on button "+e)}},{id:"button_2",label:"",width:30,padding:"5px","class":"",font:"FontAwesome",callback:function(e){console.log("Click Override on button "+e)}}]),this},r.prototype.widgetSize=function(e,t){var n=this.clientWidth(),r=this.clientHeight();return this.title()&&(r-=this.calcHeight(e)),r-=this.calcFrameHeight(t),n-=this.calcFrameWidth(t),{width:n,height:r}},r.prototype.enter=function(e,n){t.prototype.enter.apply(this,arguments)},r.prototype.update=function(n,r){t.prototype.update.apply(this,arguments);var i=this;r.style("border-width",this.surfaceBorderWidth_exists()?this.surfaceBorderWidth()+"px":null).style("border-color",this.surfaceBorderColor()).style("border-radius",this.surfaceBorderRadius_exists()?this.surfaceBorderRadius()+"px":null).style("background-color",this.surfaceBackgroundColor());var s=r.selectAll(".surfaceTitle").data(this.title()?[this.title()]:[]);s.enter().insert("h3","div").attr("class","surfaceTitle"),s.text(function(e){return e}).style("text-align",this.surfaceTitleAlignment()).style("color",this.surfaceTitleFontColor()).style("font-size",this.surfaceTitleFontSize()+"px").style("font-family",this.surfaceTitleFontFamily()).style("font-weight",this.surfaceTitleFontBold()?"bold":"normal").style("background-color",this.surfaceTitleBackgroundColor()).style("padding",this.surfaceTitlePadding()+"px"),s.exit().remove();var o=r.select(".surfaceTitle"),u=o.append("div").attr("class","html-button-container").selectAll(".surface-button").data(this.buttonAnnotations());u.enter().append("button").classed("surface-button",!0).each(function(t,n){var r=i._surfaceButtons[n]=e.select(this).attr("class","surface-button "+t.class).attr("id",t.id).style("padding",t.padding).style("width",t.width).style("height",t.height).style("cursor","pointer");t.font==="FontAwesome"?r.append("i").attr("class","fa").text(function(e){return t.label}).on("click",function(e){i.click(e)}):r.text(function(e){return t.label}).on("click",function(e){i.click(e)})}),u.exit().each(function(t,n){var r=e.select(this);delete i._surfaceButtons[n],r.remove()});var a=r.selectAll("#"+this._id+" > .surfaceWidget").data(this.widget()?[this.widget()]:[],function(e){return e._id});a.enter().append("div").attr("class","surfaceWidget").each(function(e){e.target(this)}),a.style("padding",this.surfacePadding_exists()?this.surfacePadding()+"px":null).each(function(t){var n=i.widgetSize(r.select("h3"),e.select(this));n.width<0&&(n.width=0),n.height<0&&(n.height=0),t.resize({width:n.width,height:n.height})}),a.exit().each(function(e){e.target(null)}).remove()},r.prototype.exit=function(e,n){this.widget()&&(this.widget(null),this.render()),t.prototype.exit.apply(this,arguments)},r.prototype.click=function(e){console.log("Clicked: "+e.id)},r}),function(e,t){typeof define=="function"&&define.amd?define("layout/Cell.js",["./Surface"],t):e.layout_Cell=t(e.layout_Surface)}(this,function(e){function t(){e.call(this),this._dragHandles=["nw","n","ne","e","se","s","sw","w"]}return t.prototype=Object.create(e.prototype),t.prototype.constructor=t,t.prototype._class+=" layout_Cell",t.prototype.publish("gridRow",0,"number","Grid Row Position",null,{tags:["Private"]}),t.prototype.publish("gridCol",0,"number","Grid Column Position",null,{tags:["Private"]}),t.prototype.publish("gridRowSpan",1,"number","Grid Row Span",null,{tags:["Private"]}),t.prototype.publish("gridColSpan",1,"number","Grid Column Span",null,{tags:["Private"]}),t.prototype.publish("handleSize",6,"number","Grid Row Position",null,{tags:["Private"]}),t.prototype.enter=function(t,n){e.prototype.enter.apply(this,arguments),n.classed("layout_Surface",!0)},t.prototype.update=function(t,n){e.prototype.update.apply(this,arguments);var r=this,i,s=n.selectAll(".dragHandle").data(this._dragHandles,function(e){return e});s.enter().append("div").attr("class",function(e){return"dragHandle dragHandle_"+e}).style("position","absolute"),s.style({padding:"0px",margin:"0px",left:function(e){switch(e){case"ne":case"e":case"se":return r._size.width-r.handleSize()+"px";case"nw":case"w":case"sw":return"0px";case"n":return i=0,r._dragHandles.indexOf("nw")!==-1&&i++,r.handleSize()*i+"px";case"s":return i=0,r._dragHandles.indexOf("sw")!==-1&&i++,r.handleSize()*i+"px"}},top:function(e){switch(e){case"nw":case"n":case"ne":return"0px";case"e":return i=0,r._dragHandles.indexOf("ne")!==-1&&i++,r.handleSize()*i+"px";case"w":return i=0,r._dragHandles.indexOf("nw")!==-1&&i++,r.handleSize()*i+"px";case"sw":case"s":case"se":return r._size.height-r.handleSize()+"px"}},width:function(e){switch(e){case"n":return i=0,r._dragHandles.indexOf("ne")!==-1&&i++,r._dragHandles.indexOf("nw")!==-1&&i++,r._size.width-r.handleSize()*i+"px";case"s":return i=0,r._dragHandles.indexOf("se")!==-1&&i++,r._dragHandles.indexOf("sw")!==-1&&i++,r._size.width-r.handleSize()*i+"px";default:return r.handleSize()+"px"}},height:function(e){switch(e){case"w":return i=0,r._dragHandles.indexOf("nw")!==-1&&i++,r._dragHandles.indexOf("sw")!==-1&&i++,r._size.height-r.handleSize()*i+"px";case"e":return i=0,r._dragHandles.indexOf("ne")!==-1&&i++,r._dragHandles.indexOf("se")!==-1&&i++,r._size.height-r.handleSize()*i+"px";default:return r.handleSize()+"px"}}}),s.exit().remove()},t}),function(e,t){typeof define=="function"&&define.amd?define("layout/Border.js",["d3","../common/HTMLWidget","./Cell","../common/Text","css!./Border"],t):e.layout_Border=t(e.d3,e.common_HTMLWidget,e.layout_Cell,e.common_Text)}(this,function(e,t,n,r){function i(){t.call(this),this._tag="div",this._colCount=0,this._rowCount=0,this._colSize=0,this._rowSize=0,this.content([]),this.sectionTypes([])}return i.prototype=Object.create(t.prototype),i.prototype.constructor=i,i.prototype._class+=" layout_Border",i.prototype.publish("designMode",!1,"boolean","Design Mode",null,{tags:["Basic"]}),i.prototype.publish("content",[],"widgetArray","widgets",null,{tags:["Intermediate"]}),i.prototype.publish("gutter",2,"number","Gap Between Widgets",null,{tags:["Basic"]}),i.prototype.publish("layoutType","Default","set","This determines the placement/size of the Cells relative to the Border._target element",["Default"],{tags:["Private"]}),i.prototype.publish("topCellSize",0,"number","Height of the 'Top' Cell (px)",null,{tags:["Private"]}),i.prototype.publish("leftCellSize",0,"number","Width of the 'Left' Cell (px)",null,{tags:["Private"]}),i.prototype.publish("rightCellSize",0,"number","Width of the 'Right' Cell (px)",null,{tags:["Private"]}),i.prototype.publish("bottomCellSize",0,"number","Height of the 'Bottom' Cell (px)",null,{tags:["Private"]}),i.prototype.publish("topCellPercentage",20,"number","Percentage (of parent) Height of the 'Top' Cell",null,{tags:["Private"]}),i.prototype.publish("leftCellPercentage",20,"number","Percentage (of parent) Width of the 'Left' Cell",null,{tags:["Private"]}),i.prototype.publish("rightCellPercentage",20,"number","Percentage (of parent) Width of the 'Right' Cell",null,{tags:["Private"]}),i.prototype.publish("bottomCellPercentage",20,"number","Percentage (of parent) Height of the 'Bottom' Cell",null,{tags:["Private"]}),i.prototype.publish("cellPadding",0,"number","Cell Padding (px)",null,{tags:["Intermediate"]}),i.prototype.publish("sectionTypes",[],"array","Section Types sharing an index with 'content' - Used to determine position/size.",null,{tags:["Private"]}),i.prototype.testData=function(){return this.setContent("topSection",(new r).testData()).setContent("rightSection",(new r).testData()).setContent("bottomSection",(new r).testData()).setContent("leftSection",(new r).testData()).setContent("centerSection",(new r).testData()),this},i.prototype.applyLayoutType=function(e){var t=this.borderLayoutObject(e);this.content().forEach(function(e,n){e._fixedLeft=t[this.sectionTypes()[n]].left,e._fixedTop=t[this.sectionTypes()[n]].top,e._fixedWidth=t[this.sectionTypes()[n]].width,e._fixedHeight=t[this.sectionTypes()[n]].height,e._dragHandles=this.cellSpecificDragHandles(this.sectionTypes()[n])},this)},i.prototype.cellSpecificDragHandles=function(e){switch(this.layoutType()){default:switch(e){case"topSection":return["s"];case"rightSection":return["w"];case"bottomSection":return["n"];case"leftSection":return["e"];case"centerSection":return[]}}},i.prototype.borderLayoutObject=function(e){function y(e){e.width.px=typeof e.width.px!="undefined"?e.width.px:0,e.width["%"]=typeof e.width["%"]!="undefined"?e.width["%"]:0,e.height.px=typeof e.height.px!="undefined"?e.height.px:0,e.height["%"]=typeof e.height["%"]!="undefined"?e.height["%"]:0;var t={width:e.width.px+e.width["%"]/100*g.width,height:e.height.px+e.height["%"]/100*g.height,top:e.top.px+e.top["%"]/100*g.height+u.gutter()/2,left:e.left.px+e.left["%"]/100*g.width+u.gutter()/2};return t}var t,n,r,i,s,o={},u=this,a,f,l,c,h,p,d,v,m=this.target().getBoundingClientRect(),g={};g.top=m.top,g.left=m.left,g.bottom=m.bottom,g.right=m.right,this.target()instanceof SVGElement?(g.width=parseFloat(this.target().getAttribute("width")),g.height=parseFloat(this.target().getAttribute("height"))):(g.width=m.width,g.height=m.height);switch(e){default:this.sectionTypes().indexOf("topSection")!==-1&&(a=this.topCellSize(),f=this.topCellPercentage()),this.sectionTypes().indexOf("bottomSection")!==-1&&(l=this.bottomCellSize(),c=this.bottomCellPercentage()),this.sectionTypes().indexOf("leftSection")!==-1&&(h=this.leftCellSize(),p=this.leftCellPercentage()),this.sectionTypes().indexOf("rightSection")!==-1&&(d=this.rightCellSize(),v=this.rightCellPercentage()),t=y({width:{px:0,"%":100},height:{px:a,"%":f},top:{px:0,"%":0},left:{px:0,"%":0}}),n=y({width:{px:0,"%":100},height:{px:l,"%":c},top:{px:0,"%":100},left:{px:0,"%":0}}),n.top-=n.height,i=y({width:{px:h,"%":p},height:{px:-t.height-n.height,"%":100},top:{px:t.height,"%":0},left:{px:0,"%":0}}),r=y({width:{px:d,"%":v},height:{px:-t.height-n.height,"%":100},top:{px:t.height,"%":0},left:{px:0,"%":100}}),r.left-=r.width,s=y({width:{px:-r.width-i.width,"%":100},height:{px:-t.height-n.height,"%":100},top:{px:t.height,"%":0},left:{px:i.width,"%":0}}),o.topSection=t,o.bottomSection=n,o.rightSection=r,o.leftSection=i,o.centerSection=s}return o},i.prototype.clearContent=function(e){if(!e)this.content().forEach(function(e){return e.target(null),!1}),this.content([]),this.sectionTypes([]);else{var t=this.sectionTypes().indexOf(e);t>=0&&(this.content().splice(t,1),this.sectionTypes().splice(t,1))}},i.prototype.hasContent=function(e,t,n){return this.sectionTypes().indexOf(e)>=0},i.prototype.setContent=function(e,t,r){this.clearContent(e),r=typeof r!="undefined"?r:"";if(t){var i=(new n).widget(t).title(r);this.content().push(i),this.sectionTypes().push(e)}return this},i.prototype.getContent=function(e){var t=this.sectionTypes().indexOf(e);return t>=0?this.content()[t].widget():null},i.prototype.getCellSize=function(e){switch(this.sectionTypes()[e]){case"topSection":return this.topCellSize();case"rightSection":return this.rightCellSize();case"bottomSection":return this.bottomCellSize();case"leftSection":return this.leftCellSize()}},i.prototype.changeCellSize=function(e,t){switch(this.sectionTypes()[e]){case"topSection":this.topCellSize(this.topCellSize()+t);break;case"rightSection":this.rightCellSize(this.rightCellSize()+t);break;case"bottomSection":this.bottomCellSize(this.bottomCellSize()+t);break;case"leftSection":this.leftCellSize(this.leftCellSize()+t);break;case"centerSection":this.centerCellSize(this.centerCellSize()+t)}},i.prototype.overHandle=function(e){var t="",n=this._dragCell.handleSize(),r=this._offsetY+this._dragCell._fixedTop-this.gutter()/2,i=this._offsetX+this._dragCell._fixedLeft-this.gutter()/2,s=this._dragCell._fixedWidth,o=this._dragCell._fixedHeight;return Math.ceil(r+o-this.gutter())>=e.clientY&&Math.floor(r+o-n-this.gutter())<=e.clientY?t="s":Math.floor(r)<=e.clientY&&Math.ceil(r+n)>=e.clientY&&(t="n"),Math.ceil(i+s-this.gutter())>=e.clientX&&Math.floor(i+s-n-this.gutter())<=e.clientX?t+="e":Math.floor(i)<=e.clientX&&Math.ceil(i+n)>=e.clientX&&(t+="w"),t},i.prototype.setLayoutOffsets=function(){this._offsetX=this._element.node().getBoundingClientRect().left+this.gutter()/2,this._offsetY=this._element.node().getBoundingClientRect().top+this.gutter()/2},i.prototype.dragStart=function(t,n){e.event.sourceEvent.stopPropagation();var r=this;this._dragCell=t,this._dragCellStartSize=this.getCellSize(n),r._handle=r.overHandle(e.event.sourceEvent),r._dragCell._dragHandles.indexOf(r._handle)===-1&&(r._handle=undefined),this._dragPrevX=e.event.sourceEvent.clientX,this._dragPrevY=e.event.sourceEvent.clientY},i.prototype.dragTick=function(t,n){if(this._handle){var r=this._dragPrevX-e.event.sourceEvent.clientX,i=this._dragPrevY-e.event.sourceEvent.clientY;switch(this._sectionTypeArr[n]){case"topSection":i!==0&&this.changeCellSize(n,-i);break;case"rightSection":r!==0&&this.changeCellSize(n,r);break;case"bottomSection":i!==0&&this.changeCellSize(n,i);break;case"leftSection":r!==0&&this.changeCellSize(n,-r);break;case"centerSection":}this._dragPrevX=e.event.sourceEvent.clientX,this._dragPrevY=e.event.sourceEvent.clientY}this.render()},i.prototype.dragEnd=function(e){this.render()},i.prototype.size=function(e){var n=t.prototype.size.apply(this,arguments);return arguments.length&&this.contentDiv&&this.contentDiv.style("width",this._size.width+"px").style("height",this._size.height+"px"),n},i.prototype.enter=function(e,n){t.prototype.enter.apply(this,arguments),n.style("position","relative"),this.contentDiv=n.append("div"),this._scrollBarWidth=this.getScrollbarWidth()},i.prototype.update=function(n,r){t.prototype.update.apply(this,arguments),this._sectionTypeArr=this.sectionTypes();var i=this;this.setLayoutOffsets();var s=this.contentDiv.selectAll(".cell_"+this._id).data(this.content(),function(e){return e._id});s.enter().append("div").attr("class","cell_"+this._id).style("position","absolute").each(function(e){e.target(this)});var o=e.behavior.drag().on("dragstart",function(e,t){i.dragStart.call(i,e,t)}).on("drag",function(e,t){i.dragTick.call(i,e,t)}).on("dragend",function(e,t){i.dragEnd.call(i,e,t)});this.designMode()?this.contentDiv.selectAll(".cell_"+this._id).call(o):this.contentDiv.selectAll(".cell_"+this._id).on(".drag",null),this.applyLayoutType(this.layoutType()),s.style("left",function(e){return e._fixedLeft+"px"}).style("top",function(e){return e._fixedTop+"px"}).style("width",function(e){return e._fixedWidth-i.gutter()+"px"}).style("height",function(e){return e._fixedHeight-i.gutter()+"px"}).each(function(e){e._parentElement.attr("draggable",i.designMode()).selectAll(".dragHandle").attr("draggable",i.designMode()),e.surfacePadding(i.cellPadding()).resize()}),s.exit().each(function(e){e.target(null)}).remove()},i.prototype.exit=function(e,n){t.prototype.exit.apply(this,arguments)},i}),function(e,t){typeof define=="function"&&define.amd?define("layout/Grid.js",["d3","../common/HTMLWidget","./Cell","../common/TextBox","../common/Utility","css!./Grid"],t):e.layout_Grid=t(e.d3,e.common_HTMLWidget,e.layout_Cell,e.common_TextBox,e.common_Utility)}(this,function(e,t,n,r,i){function s(){t.call(this),this._tag="div",this._colCount=0,this._rowCount=0,this._colSize=0,this._rowSize=0,this._selectionBag=new i.Selection,this.content([])}return s.prototype=Object.create(t.prototype),s.prototype.constructor=s,s.prototype._class+=" layout_Grid",s.prototype.publish("designMode",!1,"boolean","Design Mode",null,{tags:["Basic"]}),s.prototype.publish("gutter",4,"number","Gap Between Widgets",null,{tags:["Basic"]}),s.prototype.publish("fitTo","all","set","Sizing Strategy",["all","width"],{tags:["Basic"]}),s.prototype.publish("designGridColor","#ddd","html-color","Color of grid lines in Design Mode",null,{tags:["Private"]}),s.prototype.publish("designGridColorExtra","#333333","html-color","Color of excess grid lines in Design Mode",null,{tags:["Private"]}),s.prototype.publish("cellPadding",null,"string","Cell Padding (px)",null,{tags:["Intermediate"]}),s.prototype.publish("extraDesignModeWidth",2,"number","Number of additional columns added when in Design Mode.",null,{tags:["Private"]}),s.prototype.publish("extraDesignModeHeight",2,"number","Number of additional rows added when in Design Mode.",null,{tags:["Private"]}),s.prototype.publish("cellDensity",3,"string","Increase the cell density with this multiplier (Ex: 3 results in 3 cols per col and 3 rows per row)",null,{tags:["Intermediate"]}),s.prototype.publish("content",[],"widgetArray","widgets",null,{tags:["Basic"]}),s.prototype.testData=function(){return this.setContent(0,0,(new r).testData()).setContent(0,1,(new r).testData()).setContent(1,0,(new r).testData()).setContent(1,1,(new r).testData()).setContent(0,2,(new r).testData(),"Title AAA",2,2).setContent(2,0,(new r).testData(),"Title BBB",2,4),this},s.prototype.getDimensions=function(){var e={width:0,height:0};return this.content().forEach(function(t){e.width<t.gridCol()+t.gridColSpan()&&(e.width=t.gridCol()+t.gridColSpan()),e.height<t.gridRow()+t.gridRowSpan()&&(e.height=t.gridRow()+t.gridRowSpan())},this),e},s.prototype.clearContent=function(){this.content(this.content().filter(function(e){return e.target(null),!1}))},s.prototype.setContent=function(e,t,r,i,s,o){s=s||1,o=o||1,i=i||"";var u=this.cellDensity();this.content(this.content().filter(function(n){return n.gridRow()===e*u&&n.gridCol()===t*u?(n.target(null),!1):!0}));if(r){var a=(new n).gridRow(e*u).gridCol(t*u).widget(r).title(i).gridRowSpan(s*u).gridColSpan(o*u);this.prevDensity=u,this.content().push(a)}return this},s.prototype.getCell=function(e,t){var n=null;return this.content().some(function(r){return e>=r.gridRow()&&e<r.gridRow()+r.gridRowSpan()&&t>=r.gridCol()&&t<r.gridCol()+r.gridColSpan()?(n=r,!0):!1}),n},s.prototype.getContent=function(e){var t=null;return this.content().some(function(n){return n.widget()._id===e?(t=n.widget(),!0):!1}),t},s.prototype.updateCellMultiples=function(){var e=this;this.prevDensity!==this.cellDensity()&&(this.content().forEach(function(t){if(e.prevDensity&&e.cellDensity()){var n=e.prevDensity,r=e.cellDensity();t.gridRow(Math.floor(t.gridRow()*r/n)),t.gridCol(Math.floor(t.gridCol()*r/n)),t.gridRowSpan(Math.floor(t.gridRowSpan()*r/n)),t.gridColSpan(Math.floor(t.gridColSpan()*r/n))}}),this.prevDensity=this.cellDensity())},s.prototype.childMoved=s.prototype.debounce(function(e,t){this.render()},250),s.prototype.enter=function(e,n){t.prototype.enter.apply(this,arguments),n.style("position","relative"),this.dropDiv=n.append("div"),this.contentDiv=n.append("div"),this._scrollBarWidth=this.getScrollbarWidth()},s.prototype.findCurrentLocation=function(e){this._currLoc=[Math.floor((e.clientX-this._offsetX)/this._colSize),Math.floor((e.clientY-this._offsetY)/this._rowSize)]},s.prototype.overHandle=function(e){var t="",n=this._dragCell.handleSize(),r=this._dragCell.gridRowSpan()===this._currLoc[1]-this._dragCell.gridRow()+1,i=this._dragCell.gridRow()===this._currLoc[1],s=this._dragCell.gridColSpan()===this._currLoc[0]-this._dragCell.gridCol()+1,o=this._dragCell.gridCol()===this._currLoc[0],u=this._offsetY+this._currLoc[1]*this._rowSize,a=this._offsetX+this._currLoc[0]*this._colSize,f=this._colSize-this.gutter(),l=this._rowSize-this.gutter();return Math.ceil(u+l)>=e.clientY&&Math.floor(u+l-n)<=e.clientY&&r?t="s":Math.floor(u)<=e.clientY&&Math.ceil(u+n)>=e.clientY&&i&&(t="n"),Math.ceil(a+f)>=e.clientX&&Math.floor(a+f-n)<=e.clientX&&s?t+="e":Math.floor(a)<=e.clientX&&Math.ceil(a+n)>=e.clientX&&o&&(t+="w"),t},s.prototype.createDropTarget=function(e){var t=e[0]-this._dragCellOffsetX,n=e[1]-this._dragCellOffsetY,r=this._dragCell.gridColSpan(),i=this._dragCell.gridRowSpan(),s=document.createElement("div");s.id="grid-drop-target"+this.id(),s.className="grid-drop-target",this._element.node().appendChild(s),this.updateDropTarget(t,n,r,i)},s.prototype.setGridOffsets=function(){this._offsetX=this._element.node().getBoundingClientRect().left+this.gutter()/2,this._offsetY=this._element.node().getBoundingClientRect().top+this.gutter()/2},s.prototype.updateDropTarget=function(e,t,n,r){var i,s,o,u;i=this._offsetY+t*this._rowSize,s=this._offsetX+e*this._colSize,o=n*this._colSize-this.gutter(),u=r*this._rowSize-this.gutter();var a=document.getElementById("grid-drop-target"+this.id());a.style.top=i+"px",a.style.left=s+"px",a.style.width=o+"px",a.style.height=u+"px"},s.prototype.moveDropTarget=function(e){if(this._handle){var t=[];switch(this._handle){case"nw":t=[this._dragCell.gridCol()+this._dragCell.gridColSpan()-1,this._dragCell.gridRow()+this._dragCell.gridRowSpan()-1];break;case"n":case"ne":t=[this._dragCell.gridCol(),this._dragCell.gridRow()+this._dragCell.gridRowSpan()-1];break;case"e":case"se":case"s":t=[this._dragCell.gridCol(),this._dragCell.gridRow()];break;case"sw":case"w":t=[this._dragCell.gridCol()+this._dragCell.gridColSpan()-1,this._dragCell.gridRow()]}switch(this._handle){case"e":case"w":this._locY=t[1];break;default:this._locY=e[1]<=t[1]?e[1]:t[1]}switch(this._handle){case"n":case"s":this._locX=t[0];break;default:this._locX=e[0]<=t[0]?e[0]:t[0]}switch(this._handle){case"n":case"s":this._sizeX=this._dragCell.gridColSpan();break;default:this._sizeX=Math.abs(e[0]-t[0])+1}switch(this._handle){case"e":case"w":this._sizeY=this._dragCell.gridRowSpan();break;default:this._sizeY=Math.abs(e[1]-t[1])+1}}else if(document.getElementById("grid-drop-target"+this.id())!==null){var n=this.getCell(e[1],e[0]);n!==null&&this._dragCell._id!==n._id?(document.getElementById("grid-drop-target"+this.id()).className="grid-drop-target drop-target-over",this._locX=n.gridCol(),this._locY=n.gridRow(),this._sizeX=n.gridColSpan(),this._sizeY=n.gridRowSpan()):(document.getElementById("grid-drop-target"+this.id()).className="grid-drop-target",this._locX=e[0]-this._dragCellOffsetX,this._locY=e[1]-this._dragCellOffsetY,this._sizeX=this._dragCell.gridColSpan(),this._sizeY=this._dragCell.gridRowSpan())}this.updateDropTarget(this._locX,this._locY,this._sizeX,this._sizeY)},s.prototype.updateCells=function(t,n){var r=this;this.updateCellMultiples();var i=this.contentDiv.selectAll(".cell_"+this._id).data(this.content(),function(e){return e._id});i.enter().append("div").attr("class","cell_"+this._id).style("position","absolute").each(function(e){e.target(this),e.__grid_watch=e.watch(function(e,t,n){r._renderCount&&e.indexOf("grid")===0&&t!==n&&r.childMoved()})});var s=e.behavior.drag().on("dragstart",function(t){e.event.sourceEvent.stopPropagation(),r._dragCell=t,r.setGridOffsets(),r.findCurrentLocation(e.event.sourceEvent),r._startLoc=[r._currLoc[0],r._currLoc[1]],r._element.selectAll(".dragHandle").style("visibility","hidden"),r._handle=r.overHandle(e.event.sourceEvent),r._dragCell._dragHandles.indexOf(r._handle)===-1&&(r._handle=undefined),r._dragCellOffsetX=r._currLoc[0]-t.gridCol(),r._dragCellOffsetY=r._currLoc[1]-t.gridRow(),r.createDropTarget(r._currLoc),setTimeout(function(){r.contentDiv.selectAll(".cell_"+r._id).classed("dragItem",function(e){return t._id===e._id}).classed("notDragItem",function(e){return t._id!==e._id})},0),r._initSelection=!0}).on("drag",function(t){r._initSelection=!1,r._dragCell=t,r.findCurrentLocation(e.event.sourceEvent);if(typeof r._currLocation=="undefined"||r._currLocation[0]!==r._currLoc[0]||r._currLocation[1]!==r._currLoc[1])r._currLocation=r._currLoc,r.moveDropTarget(r._currLoc)}).on("dragend",function(){e.event.sourceEvent.stopPropagation(),(r._initSelection||r._startLoc[0]===r._currLoc[0]||r._startLoc[1]===r._currLoc[1])&&r.selectionBagClick(r.getCell(r._currLoc[1],r._currLoc[0])),r._element.selectAll(".dragHandle").style("visibility",null);if(r._handle)r._dragCell.gridRow(r._locY),r._dragCell.gridRowSpan(r._sizeY),r._dragCell.gridCol(r._locX),r._dragCell.gridColSpan(r._sizeX);else{var t=r._currLoc[1],n=r._currLoc[0],i=r._dragCell.gridRowSpan(),s=r._dragCell.gridColSpan(),o=r.getCell(r._currLoc[1],r._currLoc[0]);o===r._dragCell&&(i=o.gridRowSpan(),s=o.gridColSpan(),o=null);var u,a;o?(t=o.gridRow(),n=o.gridCol(),i=o.gridRowSpan(),s=o.gridColSpan(),o.gridCol(r._dragCell.gridCol()).gridColSpan(r._dragCell.gridColSpan()).gridRow(r._dragCell.gridRow()).gridRowSpan(r._dragCell.gridRowSpan()),u=n,a=t):(u=n-r._dragCellOffsetX,a=t-r._dragCellOffsetY),r._dragCell.gridCol(u).gridRow(a).gridColSpan(s).gridRowSpan(i)}var f=document.getElementById("grid-drop-target"+r.id());f.parentNode.removeChild(f),setTimeout(function(){r.contentDiv.selectAll(".cell_"+r._id).classed("dragItem",!1).classed("notDragItem",!1)},0),r._dragCell=null});this.designMode()?(this.contentDiv.selectAll(".cell_"+this._id).call(s),e.select(r._target).on("click",function(){r._selectionBag.clear(),r.postSelectionChange()})):(this.contentDiv.selectAll(".cell_"+this._id).on(".drag",null),this._selectionBag.clear()),i.style("left",function(e){return e.gridCol()*t+r.gutter()/2+"px"}).style("top",function(e){return e.gridRow()*n+r.gutter()/2+"px"}).style("width",function(e){return e.gridColSpan()*t-r.gutter()+"px"}).style("height",function(e){return e.gridRowSpan()*n-r.gutter()+"px"}).each(function(e){e._parentElement.attr("draggable",r.designMode()).selectAll(".dragHandle").attr("draggable",r.designMode()),e.surfacePadding(r.cellPadding()).resize()}),i.exit().each(function(e){e.target(null),e.__grid_watch&&e.__grid_watch.remove()}).remove()},s.prototype.postSelectionChange=function(){},s.prototype.updateDropCells=function(e,t,n){function d(e){return parseInt(e)+.5}function v(e,t,n,r,i){u.beginPath(),u.strokeStyle=i,u.moveTo(e,n),u.lineTo(t,r),u.stroke()}function m(){var i=!1;return typeof r.prevDimensions=="undefined"?i=!0:r.prevDimensions.width!==e.width||r.prevDimensions.height!==e.height?i=!0:r.prevCellWidth!==t||r.prevCellHeight!==n?i=!0:r._target.style.backgroundImage===""&&r.designMode()&&(i=!0),i}var r=this;if(m())if(this.designMode()){var i=document.createElement("canvas");i.width=e.width*t,i.height=e.height*n;var s=(e.width-this.extraDesignModeWidth())*t,o=(e.height-this.extraDesignModeHeight())*n,u=i.getContext("2d"),a=0;for(var f=.5+t;f<i.width;f+=t)a++,a<e.width-this.extraDesignModeWidth()?v(d(f),d(f),0,o,this.designGridColor()):v(d(f),d(f),0,i.height,this.designGridColorExtra());var l=0;for(var c=.5+n;c<i.height;c+=n)l++,l<e.height-this.extraDesignModeHeight()?v(0,s,d(c),d(c),this.designGridColor()):v(0,i.width,d(c),d(c),this.designGridColorExtra());a=0;for(var h=.5+t;h<i.width;h+=t)a<e.width-this.extraDesignModeWidth()&&v(d(h),d(h),o,i.height,this.designGridColorExtra());l=0;for(var p=.5+n;p<i.height;p+=n)l<e.height-this.extraDesignModeHeight()&&v(s,i.width,d(p),d(p),this.designGridColorExtra());this._target&&(this._target.style.backgroundImage="url("+i.toDataURL()+")"),this.prevDimensions={width:e.width,height:e.height},this.prevCellWidth=t,this.prevCellHeight=n}else this._target.style.backgroundImage=""},s.prototype.update=function(e,n){t.prototype.update.apply(this,arguments),this._parentElement.style("overflow-x",this.fitTo()==="width"?"hidden":null),this._parentElement.style("overflow-y",this.fitTo()==="width"?"scroll":null);var r=this.getDimensions();this.designMode()&&(r.width+=this.extraDesignModeWidth(),r.height+=this.extraDesignModeHeight());var i=(this.width()-(this.fitTo()==="width"?this._scrollBarWidth:0))/r.width,s=this.fitTo()==="all"?this.height()/r.height:i;this._colCount=r.width,this._rowCount=r.height,this._colSize=i,this._rowSize=s,this.updateCells(i,s),this.updateDropCells(r,i,s)},s.prototype.exit=function(e,n){t.prototype.exit.apply(this,arguments)},s.prototype._createSelectionObject=function(e){return{_id:e._id,element:function(){return e._element},widget:e}},s.prototype.selection=function(e){return arguments.length?(this._selectionBag.set(e.map(function(e){return this._createSelectionObject(e)},this)),this):this._selectionBag.get().map(function(e){return e._id})},s.prototype.selectionBagClick=function(t){if(t!==null){var n=this._createSelectionObject(t);e.event.sourceEvent.ctrlKey?this._selectionBag.isSelected(n)?(this._selectionBag.remove(n),this.postSelectionChange()):(this._selectionBag.append(n),this.postSelectionChange()):(this._selectionBag.set([n]),this.postSelectionChange())}},s}),function(e,t){typeof define=="function"&&define.amd?define("layout/Layered.js",["d3","../common/HTMLWidget","../layout/AbsoluteSurface","../common/TextBox","../common/Text","css!./Layered"],t):e.layout_Layered=t(e.d3,e.common_HTMLWidget,e.layout_AbsoluteSurface,e.common_TextBox,e.common_Text)}(this,function(e,t,n,r,i){function s(){t.call(this),this._tag="div"}return s.prototype=Object.create(t.prototype),s.prototype.constructor=s,s.prototype._class+=" layout_Layered",s.prototype.publish("padding",0,"number","Padding"),s.prototype.publish("widgets",[],"widgetArray","widgets",null,{tags:["Private"]}),s.prototype.testData=function(){this.addLayer((new n).widgetX(0).widgetY(0).widgetWidth(100).widgetHeight(100).widget((new r).testData())).addLayer((new n).widgetX(40).widgetY(40).widgetWidth(50).widgetHeight(50).opacity(.66).widget((new r).testData())).addLayer((new n).widgetX(30).widgetY(10).widgetWidth(40).widgetHeight(30).widget((new r).testData()));var e=this;return setInterval(function(){e.widgets().sort(function(e,t){return Math.random()<.5?-1:1}),e.render()},3e3),this},s.prototype.addLayer=function(e){var t=this.widgets();return t.push(e?e:(new i).text("No widget defined for layer.")),this.widgets(t),this},s.prototype.enter=function(e,n){t.prototype.enter.apply(this,arguments),this._contentContainer=n.append("div").attr("class","container")},s.prototype.update=function(e,n){t.prototype.update.apply(this,arguments);var r=this;n.style("padding",this.padding()+"px");var i=this._contentContainer.selectAll(".content.id"+this.id()).data(this.widgets(),function(e){return e.id()});i.enter().append("div").attr("class","content id"+this.id()).each(function(e,t){e.target(this)}),i.each(function(e,t){e.resize({width:r.clientWidth(),height:r.clientHeight()}).render()}),i.exit().each(function(e,t){e.target(null)}).remove(),i.order()},s}),function(e,t){typeof define=="function"&&define.amd?define("layout/Popup.js",["d3","../common/HTMLWidget","../layout/Surface","../common/Icon","css!./Popup"],t):e.layout_Popup=t(e.d3,e.common_HTMLWidget,e.layout_Surface,e.common_Icon)}(this,function(e,t,n,r){function i(){t.call(this),this._tag="div",this._surfaceButtons=[]}return i.prototype=Object.create(t.prototype),i.prototype.constructor=i,i.prototype._class+=" layout_Popup",i.prototype.publish("popupState",!1,"boolean","State of the popup, visible (true) or hidden (false)",null,{}),i.prototype.publish("top",null,"number","Top position property of popup",null,{}),i.prototype.publish("bottom",null,"number","Bottom position property of popup",null,{}),i.prototype.publish("left",null,"number","Left position property of popup",null,{}),i.prototype.publish("right",null,"number","Right position property of popup",null,{}),i.prototype.publish("position","relative","set","Value of the 'position' property",["absolute","relative","fixed","static","initial","inherit"],{tags:["Private"]}),i.prototype.publish("showTestButton",!1,"boolean","Test Button in target",null,{}),i.prototype.publish("buttonName",null,"string","Button name property",null,{}),i.prototype.publish("buttonLabel","","string","Button label text",null,{}),i.prototype.publish("widget",null,"widget","Widget",null,{tags:["Private"]}),i.prototype.testData=function(){this.showTestButton(!0),this.position("absolute"),this.top(30);var e=this;return this._testButton=(new r).on("click",function(){e.updateState(!e.popupState())},!0),this.widget((new n).widget((new r).testData())),this},i.prototype.widgetSize=function(e){var t=this.clientWidth()-this.calcFrameWidth(e),n=this.clientHeight()-this.calcFrameHeight(e);return{width:t,height:n}},i.prototype.updateState=function(e){this.popupState(e).render()},i.prototype.enter=function(e,n){t.prototype.enter.apply(this,arguments),this._testButton&&this._testButton.target(e.parentNode).render()},i.prototype.update=function(n,r){t.prototype.update.apply(this,arguments);var i=this;this.popupState()?r.style("display","block"):r.style("display","none");var s=r.selectAll("#"+this._id+" > .popupWidget").data(this.widget()?[this.widget()]:[],function(e){return e._id});s.enter().append("div").attr("class","popupWidget").each(function(e){e.target(this)}),s.each(function(t){var n=i.widgetSize(e.select(this));t.resize({width:n.width,height:n.height})}),s.exit().each(function(e){e.target(null)}).remove()},i.prototype.postUpdate=function(e,t){t.style("position",this.position()).style("left",this.left()+"px").style("right",this.right()+"px").style("top",this.top()+"px").style("bottom",this.bottom()+"px")},i.prototype.exit=function(e,n){this.widget()&&(this.widget(null),this.render()),t.prototype.exit.apply(this,arguments)},i.prototype.click=function(e){console.log("Clicked: "+e.id)},i}),function(e,t){typeof define=="function"&&define.amd?define("layout/Tabbed.js",["d3","../common/HTMLWidget","../layout/Surface","../common/TextBox","../common/Text","css!./Tabbed"],t):e.layout_Tabbed=t(e.d3,e.common_HTMLWidget,e.layout_Surface,e.common_TextBox,e.common_Text)}(this,function(e,t,n,r,i){function s(){t.call(this),this._tag="div"}return s.prototype=Object.create(t.prototype),s.prototype.constructor=s,s.prototype._class+=" layout_Tabbed",s.prototype.publish("showTabs",!0,"boolean","Show Tabs",null,{}),s.prototype.publish("padding",4,"number","Padding"),s.prototype.publish("activeTabIdx",0,"number","Index of active tab",null,{}),s.prototype.publish("labels",[],"array","Array of tab labels sharing an index with ",null,{tags:["Private"]}),s.prototype.publish("widgets",[],"widgetArray","widgets",null,{tags:["Private"]}),s.prototype.testData=function(){return this.addTab((new r).testData(),"MultiChart",!0).addTab((new r).testData(),"Pie Chart").addTab((new r).testData(),"Line Chart").addTab((new s).labels([]).widgets([]).addTab((new r).testData(),"Another Pie Chart").addTab((new r).testData(),"Another Line Chart",!0),"Nested Example"),this},s.prototype.clearTabs=function(){return this.widgets([]),this},s.prototype.addTab=function(e,t,r){var s=this.labels(),o=this.widgets();return r&&this.activeTabIdx(this.widgets().length),s.push(t),o.push((new n).widget(e?e:(new i).text("No widget defined for tab"))),this.labels(s),this.widgets(o),this},s.prototype.widgetSize=function(e){var t=this.clientWidth(),n=this.clientHeight(),r=this._tabContainer.node().getBoundingClientRect();return typeof r.height!="undefined"&&(n-=r.height),{width:t,height:n}},s.prototype.enter=function(e,n){t.prototype.enter.apply(this,arguments),this._tabContainer=n.append("div"),this._contentContainer=n.append("div")},s.prototype.update=function(n,r){t.prototype.update.apply(this,arguments);var i=this;r.style("padding",this.padding()+"px");var s=this._tabContainer.selectAll(".tab-button.id"+this.id()).data(this.showTabs()?this.labels():[],function(e){return e});s.enter().append("span").attr("class","tab-button id"+this.id()).style("cursor","pointer").on("click",function(e,t){i.activeTabIdx(t).render()}),s.classed("active",function(e,t){return i.activeTabIdx()===t}).text(function(e){return e}),s.exit().remove();var o=this._contentContainer.selectAll(".tab-content.id"+this.id()).data(this.widgets(),function(e){return e.id()});o.enter().append("div").attr("class","tab-content id"+this.id()).each(function(e,t){e.target(this)}),o.classed("active",function(e,t){return i.activeTabIdx()===t}).style("display",function(e,t){return i.activeTabIdx()===t?"block":"none"}).each(function(t,n){var r=i.widgetSize(e.select(this));t.surfaceBorderWidth(i.showTabs()?null:0).surfacePadding(i.showTabs()?null:0).resize(r)}),o.exit().each(function(e,t){e.target(null)}).remove()},s});